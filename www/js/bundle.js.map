{"version":3,"sources":["webpack:///webpack/bootstrap 57dc965a2f85117a006b","webpack:///./C:/Users/Patrick/WebstormProjects/Toothmaster/es6/app.js","webpack:///./C:/Users/Patrick/WebstormProjects/Toothmaster/es6/controllers.js","webpack:///./C:/Users/Patrick/WebstormProjects/Toothmaster/es6/crc16.js","webpack:///./C:/Users/Patrick/WebstormProjects/Toothmaster/es6/sendAndReceiveService.js"],"names":["bugout","debugout","window","localStorage","undefined","setItem","angular","module","service","shareSettings","obj","settings","JSON","parse","getObj","setObj","value","shareProgram","program","startPosition","log","skip","getSkip","setSkip","boolean","button","readyForData","showEmergency","showMovingButton","showCalcButton","showResetButton","showHoming","showStressTest","showVersionButton","showMoveXMm","showSpinner","getValues","setValues","keyVal","setEmergencyValues","buttonService","statusService","$rootScope","emergency","on","cb","setEmergency","$emit","off","setSending","$cordovaBluetoothSerial","bluetoothEnabled","getValue","isEnabled","then","isConnected","isConnectedService","logService","checkBluetoothEnabledService","$timeout","$window","connect","retry","deviceName","$on","getDeviceName","setDeviceName","str","connectToLastDevice","bluetoothOnVal","bluetoothOn","valueRetrieved","addOne","bluetoothSerial","connectInsecure","id","name","connectWithRetry","valuesRetrieved","turnOnBluetooth","turnOn","enable","showBluetoothSettings","connectToDeviceService","disconnect","stepMotorNum","write","setBulk","getLog","consoleLog","UILog","arr","length","unshift","indexOf","String","fromCharCode","numStr","slice","num","Number","cleanStr","pop","vars","getVars","type","return","commands","direction","startPositionSteps","Math","floor","spindleAdvancement","dipswitch","stepsPerRPM","maxRPM","maxFreq","toFixed","time","stepMotorOnOff","disableEncoder","stepsPerRPMDevidedByStepsPerRPMEncoder","encoder","maxAllowedMiss","stepsToMiss","enableEncoder","homingDirection","homingStopswitchInt","homingStopswitch","concat","logModal","emailFullLog","now","Date","cordova","plugins","email","isAvailable","logFile","resolveLocalFileSystemURL","file","externalCacheDirectory","fileSystem","getFile","create","exclusive","isFile","toString","createWriter","writer","onwriteend","subject","body","open","to","attachments","fileSystemError","$ionicPopup","alert","title","template","error","code","$ionicModal","init","$scope","promise","$new","fromTemplateUrl","scope","animation","modal","openModal","show","closeModal","hide","remove","sending","subscribed","getSending","getEmergency","getSubscribed","setSubscribed","disconnectService","pause","connected","resume","$inject","crcService","appendCRC","crc","console","Uint8High","Uint8Low","run","$ionicPlatform","$state","$ionicHistory","skipService","pauseService","event","toState","toParams","fromState","fromParams","options","currentStateName","ready","Keyboard","hideKeyboardAccessoryBar","StatusBar","styleDefault","config","$stateProvider","$urlRouterProvider","$ionicConfigProvider","views","maxCache","state","url","abstract","templateUrl","controller","otherwise","exports","i","hidePrev","slides","slide3","slide4","slide5","main","sub","sub2","swipeRightToLeft","next","prev","prevHide","nextHide","safetyReadHide","showScheme","screen","lockOrientation","unlockOrientation","setLocalStorageSafety","presets","titlePreset","sawWidth","cutWidth","pinWidth","numberOfCuts","userPrograms","currentProgram","loadLastUsedProgram","loadUserPrograms","a","key","tempName","temp","push","loadUserProgram","$index","loadPreset","checkCurrentProgram","showAlertTitle","showAlertVars","saveProgram","stringify","showAlertSaveSucces","buttons","text","onTap","modal1","modal2","index","deleteUserProgram","showDeleteAlert","sureDelete","userProg","userProgName","removeItem","splice","runProgram","checkSettings","confirmProgram","go","templateText","saveSettings","showAlertMaxFreq","showAlertSettings","settingsJSON","showAlertSaved","loadSettings","$cordovaClipboard","$interval","emergencyService","calculateVarsService","sendAndReceiveService","logModalService","modalService","unsubscribe","subscribe","bluetoothLog","runBluetoothVars","settingsDone","movements","movementsNum","done","setButtons","addToLog","clearBuffer","userDisconnect","$apply","emergencyOn","emergencyOff","addMovement","steps","descr","calcSteps","cutsAndPins","callback","subCuts","cutsRoundedUp","ceil","j","stepsPerSawWidth","remainingMM","remainingSteps","pinSteps","count","forEach","item","description","sendSettingsData","sendKfault","checkWydone","rdy","res","lastSendSettingsCommand","search","startMoving","checkDone","check","showRestartPopup","start","openHelpModal","showAnswer","QAList","question","answer","showFullLog","fullLog","fullLogPage","getFullLogExtract","end","previousFullLogPage","nextFullLogPage","homingCommands","val","homing","homingResponse","softwareVersionCommand","retriesNeeded","completedTest","sentSettingsForTest","numberOfTests","testsSent","testRunning","rdy2","listen","newCommand","nextListener","moveXMm","mm","moveXMmSteps","moveXMmStepsCommand","position","sendSettings","typeStr","initRdy","checkRdy","stressTest","response","tests","send","random","sendNext","getVersion","lastIndexOf","turnOnBluetoothService","availableDevices","pairedDevices","getAvailableDevices","ionic","Platform","isAndroid","discoverUnpaired","devices","device","list","isIOS","connectToUnpairedDevice","saveLastConnectedDevice","connectToPairedDevice","showSavedDeviceAlert","crcTableStr","crcTable","split","crcTableHex","map","parseInt","crc16","s","returnObj","c","charCodeAt","RangeError","Uint16","sendAndReceive","subscribeRawData","writeBuffered","checkInterpretedResponse","startPing","stopPing","getNewCommandID","setCommandID","resetCommandObj","expectedResponse","addToCommandObj","emitResponse","sendEmergency","createResetListener","command","lastCommandTime","lastReceivedTime","commandIdStr","commandObj","ping","data","bytes","apply","Uint8Array","commandWithCRC","commandIDObj","commandWithoutBrackets","ID","callingFunction","commandID","interpreted","checkInterpreted","cancel","commandIdNum","posStopswitch","charAt","splicedStr","missedSteps","numStr1","commandID1","err","emergencyResponse","clear"],"mappings":"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CA+G,yBAAkBnG,UAAlB;AACA5C,qBAAcH,SAAd,CAAwB,EAAC,kBAAkB,KAAnB,EAA0B,gBAAgB,KAA1C,EAAxB;AACD,MAJD,MAKK;AACJoB,kBAAWe,MAAX,CAAkB,4DAAlB;AACA;AACF,IAdD;;AAgBAgH,SAAME,MAAN,GAAe,YAAY;AACzB,SAAIT,UAAUxI,cAAc0I,UAAd,EAAd;AACA,SAAIjL,OAAOC,YAAP,CAAoB,qBAApB,MAA+C,EAA/C,IAAqD,CAAC8K,OAA1D,EAAmE;AACjE9F,8BAAuBN,gBAAvB;AACD,MAFD,MAGK,IAAIoG,OAAJ,EAAa;AAChBjL,cAAOoB,GAAP,CAAW,2CAAyC6J,OAApD;AACD;AACF,IARD;AASD,EA9BwB,CA5iB3B;AA2kBE;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA72BF,EA82BGzK,OA92BH,CA82BW,uBA92BX;;AAg3BE,iCAAsBmL,OAAtB,GAAgC,CAAC,eAAD,EAAkB,kBAAlB,EAAsC,SAAtC,EAAiD,YAAjD,EAC9B,YAD8B,EAChB,eADgB,EACC,YADD,EACe,aADf,EAC8B,eAD9B,EAC+C,WAD/C,EAC4D,UAD5D,CAAhC;;AAGFrL,SACGC,MADH,CACU,aADV,EAEGC,OAFH,CAEW,YAFX,EAEyB,CAAC,YAAY;AAClC,OAAMoL,aAAa,IAAnB;;AAEAA,cAAWC,SAAX,GAAuB,UAAU1H,GAAV,EAAe;AACpC,SAAI2H,MAAM,mBAAM3H,GAAN,CAAV;AACA4H,aAAQ3K,GAAR,CAAY,WAAS0K,IAAIE,SAAzB;AACAD,aAAQ3K,GAAR,CAAY,UAAQ0K,IAAIG,QAAxB;AACA9H,YAAO4B,OAAOC,YAAP,CAAoB8F,IAAIE,SAAxB,IAAqCjG,OAAOC,YAAP,CAAoB8F,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","file":"bundle.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 57dc965a2f85117a006b","var bugout = new debugout();\nimport controllers from './controllers';\nimport sendAndReceiveService from './sendAndReceiveService';\nimport crc16 from './crc16';\n\nif (window.localStorage['Safety'] === undefined) {\n  window.localStorage.setItem('Safety', '');\n}\nif (window.localStorage['settings'] === undefined) {\n  window.localStorage['settings'] = '{\"stepMotorNum\": 1, \"maxFreq\":5000,\"dipswitch\":5000,\"spindleAdvancement\":5,\"time\":0.2, \"homingStopswitch\": false, \"encoder\":{\"enable\": false, \"stepsPerRPM\": 0, \"stepsToMiss\": 0, \"direction\": false}}';\n}\nif (window.localStorage['lastUsedProgram'] === undefined) {\n  window.localStorage['lastUsedProgram'] = '';\n}\nif (window.localStorage['commandIdNum'] === undefined) {\n  window.localStorage['commandIdNum'] = 0;\n}\n\nangular.module('Toothmaster', ['ionic', 'starter.controllers', 'ngCordova', 'ngTouch'])\n\n  .service('shareSettings', function() {\n    var shareSettings = this;\n    shareSettings.obj = {};\n    if (window.localStorage['settings'] !== '' && window.localStorage['settings'] !== undefined) {\n      shareSettings.obj.settings = JSON.parse(window.localStorage['settings']);\n    }\n\n      shareSettings.getObj = function() {\n        return shareSettings.obj.settings;\n      };\n      shareSettings.setObj = function(value) {\n        shareSettings.obj.settings = value;\n      }\n    }\n  )\n\n  .service('shareProgram', function() {\n      var shareProgram = this;\n      shareProgram.obj = {\n        \"program\": {}\n      };\n\n      shareProgram.getObj = function() {\n        if (shareProgram.obj.program.startPosition === undefined) {\n          bugout.log('shareProgram.obj.program is undefined, setting start position to nill');\n          shareProgram.obj.program.startPosition = 0;\n        }\n        return shareProgram.obj.program;\n      };\n      shareProgram.setObj = function(value) {\n        shareProgram.obj.program = value;\n      }\n    })\n\n  .service('skipService', function () {\n    var skip = this;\n    skip.value = undefined;\n    skip.getSkip = function () {\n      return skip.value;\n    };\n    skip.setSkip = function (boolean) {\n      skip.value = boolean;\n    }\n  })\n\n  .service('buttonService', function () {\n    var button = this;\n    button.value = {};\n    button.value.readyForData = false;\n    button.value.showEmergency = false;\n    button.value.showMovingButton = false;\n    button.value.showCalcButton = false;\n    button.value.showResetButton = false;\n    button.value.showHoming = true;\n    button.value.showStressTest = true;\n    button.value.showVersionButton = true;\n    button.value.showMoveXMm = true;\n    button.value.showSpinner = false;\n\n\n    button.getValues = function () {\n      return button.value;\n    };\n\n    button.setValues = function (obj) {\n      bugout.log('buttonService.setValues called');\n      for (var keyVal in obj) {\n        switch (keyVal) {\n          case 'readyForData':\n                button.value.readyForData = obj.readyForData;\n                break;\n          case 'showEmergency':\n                button.value.showEmergency = obj.showEmergency;\n                break;\n          case 'showMovingButton':\n            button.value.showMovingButton = obj.showMovingButton;\n            break;\n          case 'showCalcButton':\n            button.value.showCalcButton = obj.showCalcButton;\n            break;\n          case 'showResetButton':\n            button.value.showResetButton = obj.showResetButton;\n            break;\n          case 'showHoming':\n            button.value.showHoming = obj.showHoming;\n            break;\n          case 'showStressTest':\n            button.value.showStressTest= obj.showStressTest;\n            break;\n          case 'showVersionButton':\n            button.value.showVersionButton= obj.showVersionButton;\n            break;\n          case 'showMoveXMm':\n            button.value.showMoveXMm= obj.showMoveXMm;\n            break;\n          case 'showSpinner':\n                button.value.showSpinner = obj.showSpinner;\n        }\n      }\n    };\n\n    button.setEmergencyValues = function () {\n      button.setValues({\n        showEmergency : false,\n        showMovingButton : false,\n        showCalcButton : false,\n        showStressTest : false,\n        showHoming : false,\n        showSpinner : false,\n        showVersionButton : false,\n        showMoveXMm : false,\n        readyForData : false,\n        showResetButton: true\n      });\n    }\n  })\n\n  .service('emergencyService',['buttonService', 'statusService', '$rootScope', function (buttonService, statusService, $rootScope) {\n    var emergency = this;\n\n    emergency.on = function (cb) {\n      bugout.log('emergencyService.on called');\n      statusService.setEmergency(true);\n      buttonService.setEmergencyValues();\n      $rootScope.$emit('emergencyOn');\n      if (cb) cb();\n    };\n\n    emergency.off = function (cb) {\n      bugout.log('emergencyService.off called');\n      statusService.setEmergency(false);\n      statusService.setSending(false);\n      $rootScope.$emit('emergencyOff');\n      emergency.value = false;\n      buttonService.setValues({\n        showEmergency : false,\n        showMovingButton : false,\n        showResetButton: false,\n        showCalcButton : true,\n        showStressTest : true,\n        showHoming : true,\n        showSpinner : false,\n        showVersionButton : true,\n        showMoveXMm : true,\n        readyForData : false\n      });\n      if (cb) cb();\n    }\n  }])\n\n  .service('checkBluetoothEnabledService', function ($cordovaBluetoothSerial) {\n    var bluetoothEnabled = this;\n    bluetoothEnabled.getValue = function (cb) {\n      $cordovaBluetoothSerial.isEnabled().then(function () {\n        bluetoothEnabled.value = true;\n        bugout.log('checkBluetoothEnabledService.value ='+bluetoothEnabled.value);\n        if (cb) cb(bluetoothEnabled.value);\n        else return bluetoothEnabled.value;\n      }, function () {\n        bluetoothEnabled.value = false;\n        bugout.log('checkBluetoothEnabledService.value ='+bluetoothEnabled.value);\n        if (cb) cb(bluetoothEnabled.value);\n        else return bluetoothEnabled.value;\n      })\n    }\n  })\n\n  .service('isConnectedService', function ($cordovaBluetoothSerial) {\n    var isConnected = this;\n    isConnected.getValue = function (cb) {\n      $cordovaBluetoothSerial.isConnected().then(function () {\n        isConnected.value = true;\n        bugout.log('isConnectedService.value ='+isConnected.value);\n        return isConnected.value;\n      }, function () {\n        isConnected.value = false;\n        bugout.log('isConnectedService.value ='+isConnected.value);\n        return isConnected.value;\n      }).then(function () {\n        if (cb) cb(isConnected.value)\n      })\n    }\n  })\n\n  .service('connectToDeviceService', ['isConnectedService', 'logService', 'checkBluetoothEnabledService', 'buttonService', '$rootScope', '$timeout', '$window',\n    function (isConnectedService, logService, checkBluetoothEnabledService, buttonService, $rootScope, $timeout, $window) {\n    var connect = this;\n      var retry = 1;\n      var deviceName = '';\n\n      $rootScope.$on('emergencyOff', function () {\n        retry = 1;\n      });\n\n      connect.getDeviceName = function (cb) {\n        if (cb) cb(deviceName);\n        else return deviceName;\n      };\n\n      connect.setDeviceName = function (str) {\n        deviceName = str;\n      };\n\n    connect.connectToLastDevice = function (bluetoothOnVal, cb) {\n      var bluetoothOn;\n      if (bluetoothOnVal === undefined) {\n        checkBluetoothEnabledService.getValue(function (value) {\n          bluetoothOn = value;\n          valueRetrieved();\n        });\n      }\n      else {\n        bluetoothOn = bluetoothOnVal;\n        valueRetrieved();\n      }\n      logService.addOne('Trying to connect with last known device');\n\n      function valueRetrieved() {\n        if (bluetoothOn && window.localStorage['lastConnectedDevice'] !== '' && window.localStorage['lastConnectedDevice'] !== undefined) {\n          bugout.log('actually connecting to lastConnected device');\n          var obj = JSON.parse(window.localStorage['lastConnectedDevice']);\n          $window.bluetoothSerial.connectInsecure(obj.id, function () {\n            connect.setDeviceName(obj.name);\n            logService.addOne('Succesfully connected to last connected device');\n            if (cb) cb();\n          }, function () {\n            bugout.log('could not connect to last connected device');\n            if (cb) cb();\n          })\n        }\n      }\n\n    };\n\n    connect.connectWithRetry = function () {\n      bugout.log('connectWithRetry called in connectService');\n      var isConnected;\n      var bluetoothOn;\n      isConnectedService.getValue(function (value) {\n        isConnected = value;\n        checkBluetoothEnabledService.getValue(function (value) {\n          bluetoothOn = value;\n          valuesRetrieved();\n        });\n      });\n\n      function valuesRetrieved() {\n        if (bluetoothOn && !isConnected) {\n          bugout.log('connectWithRetry bluetoothOn & !isConnected');\n          connect.connectToLastDevice(bluetoothOn, function () {\n            isConnectedService.getValue(function (value) {\n              isConnected = value;\n            });\n            if (!isConnected && retry < 6) {\n              bugout.log('retry connectToLastDevice');\n              $timeout(function () {\n                retry += 1;\n                bugout.log('Connect with retry, try: '+retry);\n                connect.connectWithRetry();\n              }, 500)\n            }\n            else if (isConnected) {\n              retry = 1;\n            }\n            else if (!isConnected && retry >= 6) {\n              logService.addOne('Could not connect with last known device, please make sure that device is turned on. If so, turn off your phone\\'s Bluetooth and restart the app' );\n              retry = 1;\n            }\n          })\n        }\n      }\n    }\n  }])\n\n  .service('turnOnBluetoothService',['$cordovaBluetoothSerial', 'checkBluetoothEnabledService', 'logService', function ($cordovaBluetoothSerial, checkBluetoothEnabledService, logService) {\n    var turnOnBluetooth = this;\n\n    turnOnBluetooth.turnOn = function (cb) {\n      $cordovaBluetoothSerial.enable().then(function () {\n        logService.addOne('Bluetooth has been turned on by Toothmaster app');\n        if (cb) cb();\n      }, function (){\n        $cordovaBluetoothSerial.showBluetoothSettings();\n        logService.addOne('Bluetooth should be turned on manually, redirected to Bluetooth settings');\n      })\n    }\n  }])\n\n  .service('disconnectService',['$cordovaBluetoothSerial', 'logService', 'buttonService', 'isConnectedService', '$window', 'connectToDeviceService', 'shareSettings',\n    function ($cordovaBluetoothSerial, logService, buttonService, isConnectedService, $window, connectToDeviceService, shareSettings) {\n    var disconnect = this;\n    var stepMotorNum = shareSettings.getObj().stepMotorNum;\n    disconnect.disconnect = function () {\n      stepMotorNum = shareSettings.getObj().stepMotorNum;\n      $cordovaBluetoothSerial.write('<<y8:y'+stepMotorNum+'>').then(function () {\n        $window.bluetoothSerial.disconnect(function () {\n          logService.addOne('User disconnected');\n          connectToDeviceService.setDeviceName('');\n          buttonService.setValues({'showCalcButton':false});\n          isConnectedService.getValue();\n        }, function () {\n          bugout.log('User could not disconnect');\n          logService.addOne('Could not disconnect from device');\n        })\n      });\n    }\n  }])\n\n  .service('logService', function () {\n    var logService = this;\n    //Available methods\n    logService.setBulk = setBulk;\n    logService.addOne = addOne;\n    logService.getLog = getLog;\n    logService.consoleLog = consoleLog;\n\n    //Service-scoped variables\n    logService.UILog = [];\n\n    //method functions\n    function setBulk(arr) {\n      logService.UILog = arr;\n    }\n\n    function addOne(str) {\n      bugout.log('adding to UI log: '+str);\n      if (logService.UILog.length === 0) {\n        logService.UILog.unshift(str);\n      }\n      else if (logService.UILog[0].indexOf(String.fromCharCode(40)) !== -1 && logService.UILog[0].indexOf(String.fromCharCode(41)) !== -1) {\n          var numStr = logService.UILog[0].slice(logService.UILog[0].indexOf('(')+1, logService.UILog[0].indexOf(')'));\n          var num = Number(numStr);\n          //indexOf(')')+2 because of the extra space\n          var cleanStr = logService.UILog[0].slice(logService.UILog[0].indexOf(')')+2);\n          if (str === cleanStr) {\n            num += 1;\n            logService.UILog[0] = '('+num+') '+cleanStr;\n          }\n          else {\n            logService.UILog.unshift(str);\n          }\n        }\n      else if (logService.UILog[0] === str) {\n          logService.UILog[0] = '(2) '+str;\n        }\n      else {\n          if (logService.UILog.length >= 200) {\n            logService.UILog.pop();\n            logService.UILog.unshift(str);\n          }\n          else {\n            logService.UILog.unshift(str);\n          }\n        }\n    }\n\n    function getLog(cb) {\n      if (cb) cb(logService.UILog);\n      return logService.UILog;\n    }\n\n    function consoleLog(str) {\n      bugout.log(str);\n    }\n\n  })\n\n  .service('calculateVarsService',['shareProgram', 'shareSettings', function (shareProgram, shareSettings) {\n    var vars = this;\n\n    var stepMotorNum = shareSettings.getObj().stepMotorNum;\n    //type can be: homing, test or runBluetooth\n    //TODO perhaps clean up the return of encoderCommands\n    vars.getVars = function (type, cb) {\n      stepMotorNum = shareSettings.getObj().stepMotorNum;\n      var program = shareProgram.getObj();\n      var settings = shareSettings.getObj();\n      vars.return = {\n        commands: [],\n        vars: {}\n      };\n      vars.return.vars.direction = (settings.direction) ? 1:0;\n      vars.return.vars.startPositionSteps =  Math.floor(program.startPosition / settings.spindleAdvancement * settings.dipswitch);\n      vars.return.vars.stepsPerRPM = settings.dipswitch;\n      vars.return.vars.maxRPM = (settings.maxFreq*60/settings.dipswitch).toFixed(3);\n      vars.return.vars.time = settings.time.toFixed(3);\n      vars.return.vars.stepMotorOnOff = '1';\n      vars.return.vars.disableEncoder = '<x0'+stepMotorNum+'>';\n      vars.return.vars.stepsPerRPMDevidedByStepsPerRPMEncoder = (settings.encoder.stepsPerRPM !== 0) ? (settings.dipswitch/settings.encoder.stepsPerRPM.toFixed(3)) : '';\n      vars.return.vars.stepsPerRPMDevidedByStepsPerRPMEncoder = (settings.encoder.direction) ? vars.return.vars.stepsPerRPMDevidedByStepsPerRPMEncoder*-1 : vars.return.vars.stepsPerRPMDevidedByStepsPerRPMEncoder;\n      vars.return.vars.maxAllowedMiss = (settings.encoder.stepsToMiss) ? settings.encoder.stepsToMiss : '';\n\n      var disableEncoder = ['<y8:y'+stepMotorNum+'>', '<x0'+stepMotorNum+'>'];\n\n      var enableEncoder = ['<y8:y'+stepMotorNum+'>','<x1'+stepMotorNum+'>',\n        '<d'+vars.return.vars.stepsPerRPMDevidedByStepsPerRPMEncoder+stepMotorNum+'>',\n        '<b'+vars.return.vars.maxAllowedMiss+stepMotorNum+'>'];\n\n      if (type === 'homing') {\n        vars.return.vars.homingDirection = (settings.direction) ? 0:1;\n        vars.return.vars.homingStopswitchInt = (settings.homingStopswitch) ? 0 : 1;\n        vars.return.commands = ['<v'+vars.return.vars.homingDirection+stepMotorNum+'>',\n          '<p'+vars.return.vars.stepsPerRPM+stepMotorNum+'>', '<r'+vars.return.vars.maxRPM+stepMotorNum+'>',\n          '<o'+vars.return.vars.time+stepMotorNum+'>','<h'+vars.return.vars.homingStopswitchInt+stepMotorNum+'>',\n          '<kFAULT'+stepMotorNum+'>'];\n        if (settings.encoder.enable) {\n          vars.return.commands = enableEncoder.concat(vars.return.commands)\n        }\n        else {\n          vars.return.commands = disableEncoder.concat(vars.return.commands)\n        }\n      }\n      else if (type === 'runBluetooth') {\n        vars.return.commands = ['<v'+vars.return.vars.direction+stepMotorNum+'>', '<s'+vars.return.vars.startPositionSteps+stepMotorNum+'>',\n          '<p'+vars.return.vars.stepsPerRPM+stepMotorNum+'>','<r'+vars.return.vars.maxRPM+stepMotorNum+'>',\n          '<f'+vars.return.vars.stepMotorOnOff+stepMotorNum+'>', '<o'+vars.return.vars.time+stepMotorNum+'>',\n          '<kFAULT'+stepMotorNum+'>'];\n        if (settings.encoder.enable) {\n          vars.return.commands = enableEncoder.concat(vars.return.commands)\n        }\n        else {\n          vars.return.commands = disableEncoder.concat(vars.return.commands)\n        }\n      }\n      else if (type === 'test'){\n        vars.return.commands = ['<v'+vars.return.vars.direction+stepMotorNum+'>', '<s0'+stepMotorNum+'>',\n          '<p'+vars.return.vars.stepsPerRPM+stepMotorNum+'>','<r'+vars.return.vars.maxRPM+stepMotorNum+'>',\n          '<f'+vars.return.vars.stepMotorOnOff+stepMotorNum+'>', '<o'+vars.return.vars.time+stepMotorNum+'>',\n          '<kFAULT'+stepMotorNum+'>'];\n        if (settings.encoder.enable) {\n          vars.return.commands = enableEncoder.concat(vars.return.commands)\n        }\n        else {\n          vars.return.commands = disableEncoder.concat(vars.return.commands)\n        }\n      }\n    if (cb) cb(vars.return);\n    else  return vars.return;\n    }\n  }])\n\n  .service('logModalService', function () {\n    var logModal = this;\n\n    logModal.emailFullLog = function () {\n      var now = Date.now();\n      cordova.plugins.email.isAvailable(\n        function(isAvailable) {\n          bugout.log('email available:'+isAvailable);\n          if (isAvailable === true) {\n            var logFile = bugout.getLog();\n            // save the file locally, so it can be retrieved from emailComposer\n            window.resolveLocalFileSystemURL(cordova.file.externalCacheDirectory, function(fileSystem) {\n              bugout.log('file system open: ' + fileSystem.name);\n              // create the file if it doesn't exist\n              fileSystem.getFile('log'+now+'.txt', {create: true, exclusive: false}, function(file) {\n                bugout.log(\"file is file?\" + file.isFile.toString());\n                // create writer\n                file.createWriter(function(writer) {\n                  // write\n                  writer.write(logFile);\n                  // when done writing, call up email composer\n                  writer.onwriteend = function() {\n                    bugout.log('done writing');\n                    var subject = 'Toothmaster bug report';\n                    var body = 'I have encountered an error. Could you please look into this problem? \\nMy logfile is attached.\\n\\nKind regards,\\nA Toothmaster user';\n                    cordova.plugins.email.open({\n                      to: ['p.m.c.sevat@gmail.com','info@goodlife.nu'],\n                      subject: subject,\n                      body: body,\n                      attachments: [cordova.file.externalCacheDirectory+'/'+'log'+now+'.txt']\n                    });\n                  }\n                }, fileSystemError);\n              }, fileSystemError);\n            }, fileSystemError);\n          }\n          else {\n            // not available\n            $ionicPopup.alert({\n              title: 'No email composer available',\n              template: 'There is no email app available through which the email can be sent'\n            });\n          }\n        });\n\n      function fileSystemError(error) {\n        bugout.log('Error getting file system: '+error.code);\n      }\n    }\n  })\n\n  .service('modalService', ['$ionicModal', '$rootScope', function ($ionicModal, $rootScope) {\n    var init = function (template, $scope) {\n\n      var promise;\n      $scope = $scope || $rootScope.$new();\n      promise = $ionicModal.fromTemplateUrl(template, {\n        scope: $scope,\n        animation: 'slide-in-up'\n      }).then(function (modal) {\n        $scope.modal= modal;\n        return modal\n      });\n\n      $scope.openModal = function() {\n        $scope.modal.show();\n      };\n      $scope.closeModal = function() {\n        $scope.modal.hide();\n      };\n      $scope.$on('$destroy', function() {\n        $scope.modal.remove();\n      });\n\n      return promise;\n    };\n    return {\n      init: init\n    }\n  }])\n\n  .service('statusService', function () {\n    var statusService = this;\n    statusService.sending = false;\n    statusService.emergency = false;\n    statusService.subscribed = false;\n\n    statusService.getSending = function () {\n      return statusService.sending\n    };\n\n    statusService.setSending = function (value) {\n      statusService.sending = value;\n    };\n\n    statusService.getEmergency = function () {\n      return statusService.emergency\n    };\n\n    statusService.setEmergency = function (value) {\n      statusService.emergency = value;\n    };\n\n    statusService.getSubscribed = function () {\n      bugout.log('getSubscribed called');\n      return statusService.subscribed;\n    };\n\n    statusService.setSubscribed = function (boolean) {\n      statusService.subscribed = boolean;\n    }\n  })\n\n  .service('pauseService', ['statusService', 'isConnectedService', 'logService', 'disconnectService', 'buttonService', 'connectToDeviceService',\n    function (statusService, isConnectedService, logService, disconnectService, buttonService, connectToDeviceService) {\n    var pause = this;\n\n      //TODO: fix using cb's for sending & connected?\n    pause.pause = function () {\n      //var sending = statusService.getSending();\n      var sending = statusService.getSending();\n      bugout.log('sending in pause:'+statusService.getSending());\n      var connected = isConnectedService.getValue();\n      bugout.log('pause.pause called, sending: '+sending+', connected'+connected);\n      if (!sending && connected) {\n        logService.addOne('Disconnected after pausing application');\n        disconnectService.disconnect();\n        buttonService.setValues({'showCalcButton': false, 'readyForData': false});\n      }\n      else {\n       logService.addOne('User has paused application, continuing task in background')\n      }\n    };\n\n    pause.resume = function () {\n      var sending = statusService.getSending();\n      if (window.localStorage['lastConnectedDevice'] !== '' && !sending) {\n        connectToDeviceService.connectWithRetry();\n      }\n      else if (sending) {\n        bugout.log('skipped reconnect, because sending is '+sending);\n      }\n    }\n  }])\n  //\n  // .service('sendAndReceiveService', ['statusService', 'emergencyService', '$window', 'logService', '$rootScope', 'buttonService', 'crcService', '$ionicPopup', 'shareSettings', '$interval', '$timeout',\n  //   function (statusService, emergencyService, $window, logService, $rootScope, buttonService, crcService, $ionicPopup, shareSettings, $interval, $timeout) {\n  //     var sendAndReceive = this;\n  //     var stepMotorNum = shareSettings.getObj().stepMotorNum;\n  //     var command;\n  //     var response;\n  //     var lastCommandTime;\n  //     var lastReceivedTime;\n  //     var subscribed = statusService.getSubscribed();\n  //     var commandIdStr = $window.localStorage['commandIdNum'];\n  //     var commandObj = {};\n  //     var ping;\n  //\n  //     /*\n  //      * subscribe -> send command\\write -> wait for subscribe to receive answer -> rootscope emit command + response\n  //      * -> unsubscribe when done with batch \\ unsubscribe after command -> only throw new command when done\n  //      * TODO: create the timeout check\n  //      * */\n  //\n  //     sendAndReceive.subscribe = function () {\n  //       bugout.log('subscribed');\n  //       statusService.setSubscribed(true);\n  //       $window.bluetoothSerial.subscribe('#', function (data) {\n  //         lastReceivedTime = Date.now();\n  //         sendAndReceive.emitResponse(data);\n  //       });\n  //     };\n  //\n  //     sendAndReceive.subscribeRawData = function () {\n  //       $window.bluetoothSerial.subscribeRawData(function (data) {\n  //         var bytes = String.fromCharCode.apply(null, new Uint8Array(data));\n  //         bugout.log('Rawdata: '+bytes);\n  //       })\n  //     };\n  //\n  //     sendAndReceive.unsubscribe = function () {\n  //       $window.bluetoothSerial.unsubscribe(function () {\n  //         bugout.log('Succesfully unsubscribed');\n  //         statusService.setSubscribed(false);\n  //       }, function () {\n  //         bugout.log('ERROR: could not unsubscribe');\n  //       })\n  //     };\n  //\n  //     sendAndReceive.write = function (str, cb) {\n  //       if (statusService.getEmergency() === false) {\n  //         const commandWithCRC = crcService.appendCRC(str);\n  //         $window.bluetoothSerial.write(commandWithCRC, function () {\n  //           bugout.log('sent: '+commandWithCRC);\n  //           lastCommandTime = Date.now();\n  //           if (cb) cb();\n  //         }, function () {\n  //           bugout.log('ERROR: could not send command '+str);\n  //         })\n  //       }\n  //     };\n  //\n  //     sendAndReceive.writeBuffered = function (str, callingFunction) {\n  //       var commandIDObj = sendAndReceive.addToCommandObj(str);\n  //       if (statusService.getEmergency() === false) {\n  //         var command;\n  //           //Used for buffered commands. Command with brackets: \"<r34001>\", without brackets: \"r34001\n  //         var commandWithoutBrackets = str.slice(1, str.length-1);\n  //         command = '<c'+commandWithoutBrackets+'$'+commandIDObj.ID+'>';\n  //\n  //         $window.bluetoothSerial.write(command, function () {\n  //           bugout.log('sent: '+command);\n  //           lastCommandTime = Date.now();\n  //         }, function () {\n  //           bugout.log('ERROR: could not send command '+str+' , callingFunction: '+callingFunction);\n  //         });\n  //         sendAndReceive.checkInterpretedResponse(commandIDObj.ID);\n  //       }\n  //       else {\n  //         logService.addOne('Emergency pressed, will not send command')\n  //       }\n  //     };\n  //\n  //     sendAndReceive.checkInterpretedResponse = function (commandID) {\n  //       var interpreted = false;\n  //       var checkInterpreted = $rootScope.$on('bluetoothResponse', function (event, res) {\n  //         if (res.search('10:<c') > -1 && res.search(commandID) > -1) {\n  //           interpreted = true;\n  //           checkInterpreted();\n  //         }\n  //       });\n  //       $timeout(function () {\n  //         if (!interpreted) {\n  //           bugout.log('incorrect interpretation, ID: '+commandID);\n  //           $rootScope.$emit('faultyResponse');\n  //           checkInterpreted();\n  //         }\n  //       },2500)\n  //     };\n  //\n  //     sendAndReceive.startPing = function () {\n  //       stepMotorNum = shareSettings.getObj().stepMotorNum;\n  //       ping = $interval(function () {\n  //         sendAndReceive.write('<w'+stepMotorNum+'>');\n  //       },500)\n  //     };\n  //\n  //     sendAndReceive.stopPing = function () {\n  //       $interval.cancel(ping);\n  //     };\n  //\n  //     sendAndReceive.getNewCommandID = function () {\n  //       commandIdStr = window.localStorage['commandIdNum'];\n  //       var commandIdNum = Number(commandIdStr);\n  //       commandIdNum += 1;\n  //       sendAndReceive.setCommandID(commandIdNum);\n  //       return commandIdNum;\n  //     };\n  //\n  //     sendAndReceive.setCommandID = function (num) {\n  //       window.localStorage['commandIdNum'] = num;\n  //     };\n  //\n  //     sendAndReceive.resetCommandObj = function () {\n  //       commandObj= {};\n  //     };\n  //\n  //     sendAndReceive.expectedResponse = function (str) {\n  //       stepMotorNum = shareSettings.getObj().stepMotorNum;\n  //       switch (str) {\n  //         case '<':\n  //           return '8:y';\n  //           break;\n  //         case 'd':\n  //           return '12:';\n  //           break;\n  //         case 'b':\n  //           return '13:';\n  //           break;\n  //         case 'x':\n  //           return '14:';\n  //           break;\n  //         case 'v':\n  //           return '9:';\n  //           break;\n  //         case 's':\n  //           return '6:';\n  //           break;\n  //         case 'p':\n  //           return '5:';\n  //           break;\n  //         case 'r':\n  //           return '3:';\n  //           break;\n  //         case 'o':\n  //           return '2:';\n  //           break;\n  //         case 'f':\n  //           return '11:';\n  //           break;\n  //         case 'k':\n  //           return ['0:rdy', 'FAULT'];\n  //           break;\n  //         case 'q':\n  //           buttonService.setValues({'showSpinner':true});\n  //           return ['rdy','wydone','q'];\n  //           break;\n  //         case 'h':\n  //           return '6:';\n  //           break;\n  //         case 'z':\n  //           return '14:';\n  //           break;\n  //         case 'w':\n  //           return ['wydone','w'+stepMotorNum] ;\n  //           break;\n  //       }\n  //     };\n  //\n  //     sendAndReceive.addToCommandObj = function (str) {\n  //       var id = sendAndReceive.getNewCommandID();\n  //       var expectedResponse = sendAndReceive.expectedResponse(str);\n  //       var obj = {\n  //         'ID': id,\n  //         'command': str, //ex: <q2456>\n  //         'expectedResponse': expectedResponse,\n  //         'interpreted': false,\n  //         'response': ''\n  //       };\n  //       commandObj[id] = obj;\n  //       return obj;\n  //     };\n  //\n  //     $rootScope.$on('emergencyOn', function () {\n  //       sendAndReceive.stopPing();\n  //       sendAndReceive.sendEmergency();\n  //       sendAndReceive.resetCommandObj();\n  //     });\n  //\n  //     sendAndReceive.emitResponse = function (res) {\n  //       bugout.log('response in emitResponse: '+res);\n  //       var settings = shareSettings.getObj();\n  //       //handle stopswitch hit\n  //       if (res.search('wydone:') > -1 && res.search('wydone:0') === -1) {\n  //         var posStopswitch = res.lastIndexOf('@')-3;\n  //         $ionicPopup.alert({\n  //           title: 'Error: hit stopswitch '+res.charAt(posStopswitch),\n  //           template: 'Unexpected stopswitch has been hit. Aborting task and resetting program.'\n  //         });\n  //         bugout.log('Error: hit stopswitch '+res.charAt(posStopswitch));\n  //         logService.addOne('Error: hit stopswitch '+res.charAt(posStopswitch));\n  //         //emergencyService.on sets correct buttons and sends resetcommand\n  //         emergencyService.on();\n  //         $rootScope.$emit('stopswitchHit', res, res.charAt(posStopswitch));\n  //       }\n  //\n  //       //handle encoder missed steps\n  //       //splice result from '@' till end\n  //       // in splicedStr, splice again from pos[2] ([0] = @, [1] is status code), till indexOf(';')\n  //       else if (res.search('wydone:') > -1 && res.search('@5') > -1 && settings.encoder.enable === true) {\n  //\n  //         var splicedStr = res.slice(res.lastIndexOf('@'));\n  //         var missedSteps = splicedStr.slice(2, splicedStr.indexOf(';'));\n  //         var maxAllowedMiss = settings.encoder.stepsToMiss ? settings.encoder.stepsToMiss : 'unknown';\n  //         $ionicPopup.alert({\n  //           title: 'You have missed the maximum number of allowed steps',\n  //           template: 'The program has been stopped.<p>Maximum steps to miss: '+maxAllowedMiss+'</p><p>Number of steps actually missed '+missedSteps+'</p>'\n  //         });\n  //         bugout.log('ERROR: hit max number of allowed steps');\n  //         logService.addOne('ERROR: exceeded maximum number of steps to miss (encoder setting)');\n  //         emergencyService.on();\n  //         $rootScope.$emit('maxSteps', res, missedSteps)\n  //       }\n  //       else if (res.search('2:') > -1) {\n  //         $rootScope.$emit('sendKfault', res);\n  //       }\n  //       else if (res.indexOf('$') > -1 && res.search('10:') === -1) {\n  //         bugout.log('\\nERROR:\\nPotential faulty response: '+res);\n  //         var numStr1 = res.slice(res.indexOf('$')+1, res.indexOf('>'));\n  //         var commandID1 = Number(numStr1);\n  //         var commandIDObj = commandObj[commandID1];\n  //         bugout.log('commandIDObj.command: '+commandIDObj.command);\n  //         if (res.search(commandIDObj.command) === -1) {\n  //           bugout.log('confirmed faulty response');\n  //           $rootScope.$emit('faultyResponse', res);\n  //           delete  commandObj[commandID1];\n  //         }\n  //       }\n  //       else if (res.search('&') > -1 && res.search('wydone')> -1) {\n  //         var numStr = res.slice(res.indexOf('>')+1, res.indexOf('&'));\n  //         var commandID = Number(numStr);\n  //\n  //         $rootScope.$emit('bufferedCommandDone', res, commandID);\n  //       }\n  //       else {\n  //         $rootScope.$emit('bluetoothResponse', res);\n  //       }\n  //     };\n  //\n  //     //TODO add retry to sendEmergency?\n  //     sendAndReceive.sendEmergency = function () {\n  //       bugout.log('sendAndReceiveService.sendEmergency called');\n  //\n  //       if (statusService.getSubscribed() === false) sendAndReceive.subscribe();\n  //       createResetListener( function () {\n  //         stepMotorNum = shareSettings.getObj().stepMotorNum;\n  //         $window.bluetoothSerial.write('<<y8:y'+stepMotorNum+'>', function () {\n  //           logService.addOne('Program reset command sent');\n  //         }, function (err) {\n  //           logService.addOne('Error: Program reset command could not be sent. '+err);\n  //         });\n  //       });\n  //\n  //\n  //\n  //       function createResetListener(cb) {\n  //         var emergencyResponse = $rootScope.$on('bluetoothResponse', function (event, res) {\n  //           if (res.search('<8:y>')) {\n  //             logService.addOne('Program succesfully reset');\n  //             emergencyResponse();\n  //           }\n  //         });\n  //         if (cb) cb();\n  //       }\n  //     };\n  //\n  //     sendAndReceive.clearBuffer = function () {\n  //       $window.bluetoothSerial.clear(function () {\n  //         bugout.log('Received buffer cleared');\n  //       }, function () {\n  //         bugout.log('Error: could not clear receive buffer');\n  //       })\n  //     }\n  //\n  //   }]) //end of sendAndReceiveService\n  .service('sendAndReceiveService', sendAndReceiveService);\n\n  sendAndReceiveService.$inject = ['statusService', 'emergencyService', '$window', 'logService',\n    '$rootScope', 'buttonService', 'crcService', '$ionicPopup', 'shareSettings', '$interval', '$timeout'];\n\nangular\n  .module('Toothmaster')\n  .service('crcService', [function () {\n    const crcService = this;\n\n    crcService.appendCRC = function (str) {\n      let crc = crc16(str);\n      console.log('high: '+crc.Uint8High);\n      console.log('low: '+crc.Uint8Low);\n      str += String.fromCharCode(crc.Uint8High) + String.fromCharCode(crc.Uint8Low) ;\n      return str;\n    }\n  }])\n\n  .run(function($ionicPlatform, $rootScope, $state, $window, $ionicHistory, skipService, pauseService, connectToDeviceService) {\n    bugout.log('version 0.9.9.4');\n    console.log($window.localStorage);\n      $rootScope.$on('$stateChangeStart',\n        function(event, toState, toParams, fromState, fromParams, options){\n          bugout.log('startChangeStart, fromState: '+fromState.name);\n          bugout.log('startChangeStart, toState: '+toState.name);\n        });\n\n    $ionicPlatform.on('pause', function () {\n      bugout.log('onPause called from app.js');\n      if ($ionicHistory.currentStateName() === 'app.runBluetooth' || $ionicHistory.currentStateName() === 'app.homing'\n        || $ionicHistory.currentStateName() === 'app.test' || $ionicHistory.currentStateName() === 'app.bluetoothConnection') {\n        pauseService.pause();\n      }\n      else {\n      }\n    });\n\n    $ionicPlatform.on('resume', function () {\n      bugout.log('onResume called from app.js');\n      if ($ionicHistory.currentStateName() === 'app.runBluetooth' || $ionicHistory.currentStateName() === 'app.homing'\n        || $ionicHistory.currentStateName() === 'app.test' || $ionicHistory.currentStateName() === 'app.bluetoothConnection') {\n        pauseService.resume();\n      }\n      else {\n      }\n    });\n\n  $ionicPlatform.ready(function() {\n\n    // Hide the accessory bar by default (remove this to show the accessory bar above the keyboard\n    // for form inputs)\n    if (window.cordova && window.cordova.plugins.Keyboard) {\n      cordova.plugins.Keyboard.hideKeyboardAccessoryBar(true);\n      // cordova.plugins.Keyboard.disableScroll(true);\n\n    }\n    if (window.StatusBar) {\n      // org.apache.cordova.statusbar required\n      StatusBar.styleDefault();\n    }\n\n    if (window.localStorage['lastConnectedDevice'] === undefined) {\n      window.localStorage['lastConnectedDevice'] = '';\n    }\n    else {\n      $ionicPlatform.ready(function () {\n        bugout.log('trying to connectwithretry on startup');\n        connectToDeviceService.connectWithRetry();\n      });\n    }\n\n    //bugout.log(window.localStorage);\n    bugout.log('localstorage.length ='+window.localStorage.length);\n  });\n\n})\n\n.config(function($stateProvider, $urlRouterProvider, $ionicConfigProvider) {\n  $ionicConfigProvider.views.maxCache(1);\n\n  $stateProvider\n    .state('app', {\n      name: 'app',\n    url: '/app',\n    abstract: true,\n    templateUrl: '../templates/menu.html'\n  })\n\n  .state('app.settings', {\n    name: 'settings',\n    url: '/settings',\n    views: {\n      'menuContent': {\n        templateUrl: '../templates/settings.html',\n        controller: 'SettingsCtrl'\n      }\n    }\n  })\n\n  .state('app.home', {\n      name: 'home',\n      url: '/home',\n      views: {\n        'menuContent': {\n          templateUrl: '../templates/home.html'\n        }\n      }\n  })\n\n    .state('app.safety-slide', {\n      url: '/safety-slide',\n      name: 'safety-slide',\n      views: {\n        'menuContent': {\n          templateUrl: '../templates/safety-slide.html',\n          controller: 'SafetySlides'\n        }\n      }\n    })\n\n    .state('app.program', {\n      name: 'program',\n      url: '/program',\n      views: {\n        'menuContent': {\n          templateUrl: '../templates/program.html',\n          controller: 'ProgramController'\n        }\n      }\n    })\n\n    .state('app.homing', {\n      name: 'homing',\n      url: '/homing',\n      views: {\n        'menuContent': {\n          templateUrl: '../templates/homing.html',\n          controller: 'homingCtrl'\n        }\n      }\n    })\n\n    .state('app.runBluetooth', {\n      name: 'runBluetooth',\n      url: '/runBluetooth',\n      views: {\n        'menuContent': {\n          templateUrl: '../templates/runBluetooth.html',\n          controller: 'runBluetoothCtrl'\n        }\n      }\n    })\n\n    .state('app.test', {\n      name: 'test',\n      url: '/test',\n      views: {\n        'menuContent': {\n          templateUrl: '../templates/test.html',\n          controller: 'testCtrl'\n        }\n      }\n    })\n\n    .state('app.website', {\n      name: 'website',\n      url: '/website',\n      views: {\n        'menuContent': {\n          templateUrl: '../templates/website.html'\n        }\n      }\n    })\n\n    .state('app.bluetoothConnection', {\n      name: 'bluetoothConnection',\n      url: '/bluetoothConnection',\n      views: {\n        'menuContent': {\n          templateUrl: '../templates/bluetoothConnection.html',\n          controller: 'bluetoothConnectionCtrl'\n        }\n      }\n    })\n  ;\n  // if none of the above states are matched, use this as the fallback\n  $urlRouterProvider.otherwise('/app/program');\n\n});\n\n\n\n\n\n\n// WEBPACK FOOTER //\n// ./C:/Users/Patrick/WebstormProjects/Toothmaster/es6/app.js","module.exports = \nangular.module('starter.controllers', [])\n//TODO replace console.log with bugout.log\n  /*\n  * $rootScope emits:\n  * $rootScope.$on('emergencyOn')\n  * $rootScope.$on('emergencyOff')\n  * $rootScope.$on('stopswitchHit', response, stopswitchNumber)\n  * $rootScope.$on('maxSteps', response, missedSteps)\n  * $rootScope.$on('bluetoothResponse', response)\n  * */\n\n.controller('SafetySlides', function($scope, $ionicModal) {\n  $scope.i = 0;\n  $scope.hidePrev = false;\n\n  $scope.slides = [\n    'Start safety instructions','Usage','Caution!', 'Causes of unexpected movements: ', 'Keep in mind!', 'Mitigations against these failure modes:', 'Minimum requirements','Norms and regulations'\n  ];\n\n  $scope.slide3 = [\n    'Android/iOS is no Operating System for safety applications','Toothmaster software is not developed to aim for a certain so-called SIL(Safety Integrity Level).','You might drop something on your phone and then Toothmaster will order the stepmotor to move.','You or somebody else might by coincidence click on the continue button while making a precision cut.','There might be interference from other applications with Toothmaster.','Your phone memory might be bad. Leading to bit rot, causing inadvertant movement.','There might be Electro Magnetic Interference in your workplace (for instance if you start a heavy motor), leading to bit rot, causing inadvertant movement.','Step motor driver (step motor driver is explained here (TBD)) generates inadvertent movement etc.'\n  ];\n\n  $scope.slide4 = [\n    'Toothmaster/ OS/ smartphone generates movement when not expected.','Toothmaster/ OS/ driver keeps moving or moves too far. (could also be cause by wrong user input/ installation errors)'\n  ];\n\n  $scope.slide5 = [\n    {main: 'A) Clamping your workpiece before making a cut.', sub: 'Clamping is very simple and very safe. Of course safety has a negative effect on availability. The time to make the wood joint will be longer because the milling machine might have to be stopped, clamp has to be removed and installed for every cut.'},\n    {main: 'B) Safety Switch', sub: 'Operator operates the safety switch. Not recommended because operator could make mistakes/ shorts the safety switch on purpose.', sub2: 'Safety switch is operated by the shifting part of your machinery when the workpiece is in a safe position to move.'},\n    {main: 'C) Combination A&B', sub: 'Especially when working on expensive and big workpieces, you might consider A + B2 and even stop your machine before shifting the workpiece.'}\n  ];\n\n  $scope.swipeRightToLeft = function() {\n    if ($scope.i <7) {\n    console.log('swiping right');\n    $scope.i ++;\n    }\n  };\n\n  $scope.next = function() {\n    if ($scope.i < 7) {\n      console.log(\"next\");\n      $scope.i ++;\n    }\n  };\n\n  $scope.prev = function() {\n    if ($scope.i >= 0) {\n      console.log(\"prev\");\n      $scope.i --;\n    }\n  };\n\n  $scope.prevHide = function() {\n    return $scope.i === 0;\n  };\n\n  $scope.nextHide = function() {\n    return $scope.i === 7;\n  };\n\n  $scope.safetyReadHide = function() {\n    return $scope.i !== 7;\n  };\n\n  $scope.showScheme = function() {\n    if ($scope.i === 6) {\n      return true;\n    }\n  };\n\n  $ionicModal.fromTemplateUrl('scheme-modal.html', {\n    scope: $scope,\n    animation: 'slide-in-up'\n  }).then(function(modal) {\n    $scope.modal = modal;\n  });\n  $scope.openModal = function() {\n    $scope.modal.show();\n    window.screen.lockOrientation('landscape');\n  };\n  $scope.closeModal = function() {\n    $scope.modal.hide();\n    window.screen.unlockOrientation();\n  };\n  /*\n  //Cleanup the modal when we're done with it!\n  $scope.$on('$ionicView.leave', function() {\n    $scope.modal.remove();\n    console.log('cleaning up modal');\n  });*/\n\n  //on slide.id = 7, add read-safety-instruction button\n  $scope.setLocalStorageSafety = function() {\n    window.localStorage.setItem(\"Safety\", \"Completed\");\n  }\n})\n\n.controller('ProgramController', function($scope, $ionicModal, $ionicPopup, shareSettings, shareProgram, $state) {\n  $scope.presets = [\n    { titlePreset: '5mm everything', sawWidth: 5, cutWidth: 5, pinWidth: 5, numberOfCuts: 5, startPosition: 5  },\n    { titlePreset: '15mm everything', sawWidth: 15, cutWidth: 15, pinWidth: 15, numberOfCuts: 15, startPosition: 15  }\n  ];\n\n  $scope.userPrograms = [];\n\n  $scope.currentProgram = {\n\n  };\n\n  (function loadLastUsedProgram() {\n    if (window.localStorage['lastUsedProgram'] !== \"\" && window.localStorage['lastUsedProgram'] !== undefined) {\n      $scope.currentProgram = JSON.parse(window.localStorage['lastUsedProgram']);\n      shareProgram.setObj($scope.currentProgram);\n    }\n  })();\n\n  $scope.loadUserPrograms = function() {\n    $scope.userPrograms = [];\n    if (window.localStorage.length === 5) {\n      console.log('only safety, settings, lastConnectedDevice, commandIDNum and lastUsedProgram found in localstorage');\n    }\n    //load the userPrograms stored in localStorage. objects are named 1 - n.\n    //parse the userPrograms in localStorage so that they are converted to objects\n    //push the parsed userPrograms to $scope.userPrograms array\n    else {\n      console.log(window.localStorage);\n      for (var a=0; a<window.localStorage.length; a++) {\n        if (window.localStorage.key(a) == 'Safety' || window.localStorage.key(a) == 'settings' || window.localStorage.key(a) == 'lastUsedProgram' || window.localStorage.key(a) == 'lastConnectedDevice' || window.localStorage.key(a) == 'commandIdNum') {\n\n        }\n        else{\n          var tempName = window.localStorage.key(a);\n          var temp = window.localStorage[tempName];\n          temp = JSON.parse(temp);\n          $scope.userPrograms.push(temp);\n          console.log(tempName+' pushed to userPrograms');\n        }\n\n      }\n    }\n  };\n\n  $scope.loadUserPrograms();\n\n  $scope.loadUserProgram = function($index) {\n    //load userProgram & close load modal\n    console.log('userProgram clicked');\n    $scope.currentProgram = $scope.userPrograms[$index];\n    shareProgram.setObj($scope.currentProgram);\n    $scope.closeModal(1);\n  };\n\n  $scope.loadPreset = function($index) {\n    //load preset & close load modal\n    console.log('loadPreset clicked');\n    $scope.currentProgram = $scope.presets[$index];\n    $scope.currentProgram.title = $scope.presets[$index].titlePreset;\n    shareProgram.setObj($scope.currentProgram);\n    $scope.closeModal(1);\n  };\n\n  $scope.checkCurrentProgram = function(){\n    /*console.log('registered = '+ window.localStorage['registered']);\n    console.log('condition ='+ (window.localStorage['registered'] = 'false'));*/\n    if ($scope.currentProgram.title == null ) {\n      $scope.showAlertTitle();\n      return false;\n    }\n    /*else if ($scope.currentProgram.numberOfCuts > 2 && window.localStorage['registered'] == 'false') {\n      console.log('cannot save, number of cuts too high for restriction');\n      $scope.showAlertNumberOfCuts();\n      return false;\n    }*/\n\n    //show alert if not all program fields are filled in\n    else if ($scope.currentProgram.sawWidth == null || $scope.currentProgram.cutWidth == null\n      || $scope.currentProgram.pinWidth == null    || $scope.currentProgram.numberOfCuts == null\n      || $scope.currentProgram.startPosition == null) {\n      $scope.showAlertVars();\n      return false;\n    }\n    else {\n      return true;\n    }\n  };\n  /*\n  $scope.showAlertNumberOfCuts= function(){\n    $ionicPopup.alert(\n      {\n        title: 'Number of cuts restricted',\n        template: 'You have not registered your Toothmaster yet, please register to remove number of cuts restriction',\n        buttons: [{\n          text: 'Continue unregistered',\n          type: 'button-calm',\n          onTap: function () {\n            $scope.currentProgram.numberOfCuts = 2;\n          }\n        },{\n          text: 'Register',\n          type: 'button-balanced',\n          onTap: function () {\n            $state.go('app.register');\n          }\n        }]\n      }\n    )\n  };\n*/\n  $scope.saveProgram = function() {\n    //show alert if title is not filled in\n    if ($scope.checkCurrentProgram() === true) {\n      if ($scope.currentProgram.titlePreset) {\n        delete $scope.currentProgram.titlePreset\n      }\n      window.localStorage[$scope.currentProgram.title] = JSON.stringify($scope.currentProgram);\n      $scope.userPrograms.push($scope.currentProgram);\n      console.log('userProgram pushed to userPrograms & localStorage');\n      console.log('\\nuserPrgrams after pushed saved program:');\n      console.log($scope.userPrograms);\n      console.log('\\ncurrentProgram:');\n      console.log($scope.currentProgram);\n      //call the successful save popup\n      $scope.showAlertSaveSucces();\n      //update the list of userPrograms\n      $scope.loadUserPrograms();\n      shareProgram.setObj($scope.currentProgram);\n    }\n    else {\n      //$scope.checkCurrentProgram();\n    }\n  };\n\n    $scope.showAlertSaveSucces = function() {\n      $ionicPopup.show(\n        {\n        title: 'Program saved!',\n        scope: $scope,\n        buttons: [\n          {\n            //button holds current program & closes modal\n            text: 'Use current program',\n            type: 'button-balanced',\n            onTap: function() {\n              $scope.closeModal(2);\n            }\n          },\n          {\n            //button clears program fields and title\n            text: 'Create new program',\n            type: 'button-calm',\n            onTap: function () {\n              $scope.currentProgram.title = undefined;\n                $scope.currentProgram.sawWidth = undefined;\n                $scope.currentProgram.cutWidth = undefined;\n                $scope.currentProgram.pinWidth = undefined;\n                $scope.currentProgram.numberOfCuts = undefined;\n                $scope.currentProgram.startPosition = undefined;\n              $scope.closeModal(2);\n            }\n          }\n        ]\n        }\n      )\n    };\n\n    $scope.showAlertVars = function(){\n      $ionicPopup.alert(\n        {\n          title: 'Not all fields are filled in',\n          template: 'Please fill in all Program fields before saving the program'\n        }\n      )\n    };\n\n  $scope.showAlertTitle = function(){\n    $ionicPopup.alert(\n      {\n        title: 'Not all fields are filled in',\n        template: 'Title is not filled in'\n      }\n    )\n  };\n\n    $ionicModal.fromTemplateUrl('load-modal.html', {\n      id: 1,\n      scope: $scope,\n      animation: 'slide-in-up'\n    }).then(function(modal) {\n      $scope.modal1 = modal;\n    });\n\n    $ionicModal.fromTemplateUrl('save-modal.html', {\n      id: 2,\n      scope: $scope,\n      animation: 'slide-in-up'\n    }).then(function(modal) {\n      $scope.modal2 = modal;\n    });\n\n  $scope.openModal = function(index) {\n    if (index === 1) {\n      $scope.modal1.show();\n    }\n    else {\n      $scope.modal2.show();\n    }\n    };\n\n    $scope.closeModal = function(index) {\n      if (index === 1) {\n        $scope.modal1.hide();\n      }\n      else {\n        $scope.modal2.hide();\n      }\n\n    };\n\n  /*\n    $scope.$on('$ionicView.leave', function() {\n      $scope.modal1.remove();\n      $scope.modal2.remove();\n      console.log('modals removed')\n    });*/\n\n  $scope.deleteUserProgram = function($index) {\n    console.log('delete userProgram clicked at index: '+$index);\n    console.log($scope.userPrograms);\n    $scope.showDeleteAlert($index);\n  };\n\n    $scope.showDeleteAlert = function($index) {\n      var index = $index;\n      $ionicPopup.show(\n        {\n          title: 'Are you sure you want to delete this program?',\n          scope: $scope,\n\n          buttons: [\n            {\n              //button clears program fields and title\n              text: 'Yes',\n              type: 'button-assertive',\n              onTap: function sureDelete() {\n                console.log(window.localStorage);\n                console.log('index ='+index);\n                // remove the userProgram from localstorage. Step 1: get the key under which the userProgram is saved\n                var userProg = $scope.userPrograms[index];\n                console.log(userProg);\n                var userProgName = userProg.title;\n                console.log(userProgName);\n                window.localStorage.removeItem(userProgName);\n                //remove the userProgram visually\n                $scope.userPrograms.splice(index, 1);\n              }\n            },\n            {\n              text: 'No',\n              type: 'button-balanced'\n            }\n          ]\n        }\n      );\n\n    };\n\n  //On run program button, make sure that program and settings are filled in correctly\n    $scope.runProgram = function() {\n\n      /*\n      if ($scope.currentProgram.numberOfCuts > 2 && window.localStorage['registered'] === 'false') {\n        console.log('cannot save, number of cuts too high for restriction');\n        $scope.showAlertNumberOfCuts();\n      }\n      else */\n      if ($scope.currentProgram.sawWidth > $scope.currentProgram.cutWidth){\n        $ionicPopup.alert(\n          {\n            title: 'Saw width cannot be wider than cut width',\n            template: 'Please make sure that your saw width and cut width are entered correctly'\n          }\n        )\n      }\n      else if ($scope.currentProgram.numberOfCuts % 1 !== 0) {\n        $ionicPopup.alert(\n          {\n            title: 'Number of cuts cannot be a floating point',\n            template: 'Please make sure that the number of cuts is a whole number. \"2\" is correct, \"2.2\" is incorrect.'\n          }\n        )\n      }\n      else if ($scope.currentProgram.sawWidth > 0 && $scope.currentProgram.cutWidth > 0\n        && $scope.currentProgram.pinWidth > 0 && $scope.currentProgram.numberOfCuts > 0\n        && $scope.currentProgram.startPosition >= 0 && $scope.checkSettings()) {\n        console.log('all fields filled in');\n        shareProgram.setObj($scope.currentProgram);\n        window.localStorage['lastUsedProgram'] = JSON.stringify($scope.currentProgram);\n        $scope.confirmProgram();\n      }\n      else {\n        $ionicPopup.alert(\n          {\n            title: 'Not all fields are filled in',\n            template: 'Please fill in all Program fields before running the program'\n          }\n        )\n      }\n    };\n\n    $scope.confirmProgram = function(){\n      $ionicPopup.alert(\n        {\n          title: 'Please confirm your program',\n          template: '<p>Saw width: '+$scope.currentProgram.sawWidth+'</p>'+'<p>Cut width: '+$scope.currentProgram.cutWidth+'</p>'+\n          '<p>Pin width: '+$scope.currentProgram.pinWidth+'</p>'+'<p>Number of cuts: '+$scope.currentProgram.numberOfCuts+'</p>'+\n          '<p>Start position: '+$scope.currentProgram.startPosition+'</p>',\n          buttons: [{\n           text: 'Edit program',\n           type: 'button-calm'\n          },{\n            text: 'Confirm program',\n            type: 'button-balanced',\n            onTap: function () {\n              //$scope.confirmSettings();\n              $state.go('app.runBluetooth');\n            }\n          }]\n        }\n      )\n    };\n/*\n  $scope.confirmSettings = function() {\n    var templateText = '<p>Minimum frequency: '+$scope.settings.minFreq+'</p>'+'<p>Maximum frequency: '+$scope.settings.maxFreq+'</p>'+\n      '<p>Step motor dipswitch: '+$scope.settings.dipswitch+'</p>'+'<p>Spindle advancement: '+$scope.settings.spindleAdvancement+'</p>'+\n      '<p>Time to maximum frequency: '+$scope.settings.time+'</p>'+'<p>Encoder enabled: '+$scope.settings.encoder.enable+'</p>';\n    if ($scope.settings.encoder.enable) {\n      templateText += '<p>Encoder steps per RPM: '+$scope.settings.encoder.stepsPerRPM+'</p>'+\n        '<p>Max allowable missed steps: '+$scope.settings.encoder.stepsToMiss+'</p>'+\n        '<p>Reverse encoder direction: '+$scope.settings.encoder.direction+'</p>';\n    }\n    $ionicPopup.alert(\n      {\n        title: 'Please confirm your settings',\n        template: templateText,\n        buttons: [{\n          text: 'Edit settings',\n          type: 'button-calm',\n          onTap: function() {\n            $state.go('app.settings');\n          }\n        },\n          {\n          text: 'Confirm settings',\n          type: 'button-balanced',\n          onTap: function () {\n            $state.go('app.runBluetooth');\n          }\n\n        }]\n      }\n    )\n  };\n*/\n  $scope.settings = shareSettings.getObj();\n\n  $scope.checkSettings = function() {\n    $scope.settings = shareSettings.getObj();\n    console.log($scope.settings);\n    if ($scope.settings === undefined){\n      console.log('settings are not filled in correctly');\n      $ionicPopup.alert(\n        {\n          title: 'Please make sure your settings are filled in correctly',\n          template: 'Use the buttons to go to settings',\n          buttons: [{\n            text: 'Edit settings',\n            type: 'button-calm',\n            onTap: function() {\n              $state.go('app.settings');\n            }\n          }]\n        });\n      return false;\n    }\n\n    else if ($scope.settings.maxFreq !== null && $scope.settings.dipswitch !== null &&\n      $scope.settings.spindleAdvancement !== null && $scope.settings.time !== null && $scope.settings.stepMotorNum !== null &&\n      $scope.settings.homingStopswitch !== null && $scope.settings.encoder.enable === false) {\n      console.log('checkSettings passed');\n      return true;\n    }\n    else if ($scope.settings.maxFreq !== null  && $scope.settings.dipswitch !== null && $scope.settings.stepMotorNum !== null &&\n      $scope.settings.spindleAdvancement !== null && $scope.settings.time !== null && $scope.settings.homingStopswitch !== null && $scope.settings.encoder.enable === true &&\n      $scope.settings.encoder.stepsPerRPM !== 0 && $scope.settings.encoder.stepsToMiss > 0) {\n      console.log('checkSettings passed');\n      return true;\n    }\n    else {\n        console.log('settings are not filled in correctly');\n      var templateText = '<p>Maximum frequency: '+$scope.settings.maxFreq+'</p>'+\n        '<p>Step motor dipswitch: '+$scope.settings.dipswitch+'</p>'+'<p>Spindle advancement: '+$scope.settings.spindleAdvancement+'</p>'+\n        '<p>Time to maximum frequency: '+$scope.settings.time+'</p>'+'<p>Encoder enabled: '+$scope.settings.encoder.enable+'</p>';\n      if ($scope.settings.encoder.enable) {\n        templateText += '<p>Encoder steps per RPM: '+$scope.settings.encoder.stepsPerRPM+'</p>'+'<p>Max allowable missed steps: '+$scope.settings.encoder.stepsToMiss+'</p>'+'<p>Encoder directtion: '+$scope.settings.encoder.stepsToMiss+'</p>';\n      }\n        $ionicPopup.alert(\n          {\n            title: 'Please make sure your settings are filled in correctly',\n            template: templateText,\n            buttons: [{\n              text: 'Edit settings',\n              type: 'button-calm',\n              onTap: function() {\n                $state.go('app.settings');\n              }\n            }]\n          });\n        return false;\n      }\n    };\n  /*\n  $scope.redText = function () {\n    if ($scope.currentProgram.numberOfCuts > 2 && window.localStorage['registered'] === 'false') {\n      return true;\n    }\n  }*/\n})\n\n.controller('SettingsCtrl', function($scope, $ionicPopup, shareSettings){\n//TODO add stepmotorNum\n  $scope.settings = {\n    encoder: {\n      enable: false,\n      stepsPerRPM: undefined,\n      stepsToMiss: undefined\n    },\n    homingStopswitch: false\n  };\n\n  $scope.saveSettings = function() {\n    if ($scope.settings.maxFreq > 80000) {\n      $scope.showAlertMaxFreq();\n    }\n\n    else if ($scope.settings.maxFreq == null || $scope.settings.dipswitch == null ||\n      $scope.settings.spindleAdvancement == null || $scope.settings.time == null || $scope.settings.stepMotorNum == null) {\n      $scope.showAlertSettings();\n    }\n    else if ($scope.settings.encoder.enable && ($scope.settings.encoder.stepsPerRPM ==undefined || $scope.settings.encoder.stepsToMiss== undefined || $scope.settings.encoder.direction == undefined)){\n      $scope.showAlertSettings();\n    }\n    else {\n      var settingsJSON = JSON.stringify($scope.settings);\n      console.log(settingsJSON);\n      window.localStorage['settings'] = settingsJSON;\n      //call shareSettings service so that settings can be used in programCtrl & runBluetoothCtrl\n      shareSettings.setObj($scope.settings);\n      $scope.showAlertSaved();\n    }\n\n  };\n\n  $scope.loadSettings = function() {\n    console.log('settings: '+window.localStorage['settings']);\n    if (window.localStorage['settings'] === '' || window.localStorage['settings'] === undefined) {\n\n    }\n    else {\n      $scope.settings = JSON.parse(window.localStorage['settings']);\n    }\n  };\n\n  $scope.loadSettings();\n\n  $scope.showAlertMaxFreq = function(){\n    $ionicPopup.alert(\n      {\n        title: 'Maximum frequency invalid',\n        template: 'Please make sure that maximum frequency is set to 1000 or lower'\n      }\n    )\n  };\n\n  $scope.showAlertSettings = function(){\n    $ionicPopup.alert(\n      {\n        title: 'Not all fields are filled in',\n        template: 'Please make sure that all fields are filled in correctly'\n      }\n    )\n  };\n\n  $scope.showAlertSaved = function(){\n    $ionicPopup.alert(\n      {\n        title: 'Settings saved'\n      }\n    )\n  }\n})\n\n  .controller('runBluetoothCtrl', function($rootScope, $scope, $cordovaClipboard, $cordovaBluetoothSerial, $ionicPopup, $ionicModal,\n    $state, $ionicPlatform, $window, $interval, $timeout, shareSettings, shareProgram, skipService, buttonService, emergencyService,\n    checkBluetoothEnabledService, isConnectedService, logService, disconnectService, calculateVarsService, sendAndReceiveService,\n    statusService, connectToDeviceService, logModalService, modalService){\n\n    $scope.$on('$ionicView.beforeLeave', function () {\n      console.log('BEFORE LEAVE');\n      sendAndReceiveService.unsubscribe();\n    });\n\n    $scope.$on('$ionicView.afterEnter', function () {\n      console.log('AFTER ENTER');\n      sendAndReceiveService.subscribe();\n    });\n\n    $scope.bluetoothLog = logService.getLog();\n    $scope.bluetoothEnabled = null;\n    $scope.isConnected = null;\n    var sending = statusService.getSending();\n    var program = shareProgram.getObj();\n    console.log('program:');\n    console.log(JSON.stringify(program));\n    $scope.settings = shareSettings.getObj();\n    console.log('settings:');\n    console.log(JSON.stringify($scope.settings));\n    $scope.deviceName= connectToDeviceService.getDeviceName();\n    //TODO aren't these variables superfluous because of ionicView.enter?\n    $scope.buttons = buttonService.getValues();\n    var emergency = statusService.getEmergency();\n    var runBluetoothVars;\n\n    //settings commands\n    var commands;\n    var settingsDone;\n\n    //update steps vars\n    $scope.movements = [];\n    $scope.movementsNum = 0;\n    var done = true;\n\n    //setting vars\n    var stepMotorNum = $scope.settings.stepMotorNum;\n\n    //\n    //SECTION: changing & entering views\n    //\n\n    $scope.$on('$ionicView.unloaded', function () {\n      console.log('\\nUNLOADED\\n');\n    });\n\n    // and only calculateVarsService.getVars('runBluetooth') is called && log is imported && correct buttons are set\n    $scope.$on('$ionicView.enter',function () {\n      console.log('enterView in runBluetoothCtrl fired');\n      isConnectedService.getValue(function (value) {\n        $scope.isConnected = value;\n      });\n      checkBluetoothEnabledService.getValue(function (value) {\n        $scope.bluetoothEnabled = value;\n        console.log('$scope.bluetoothEnabled: '+$scope.bluetoothEnabled);\n      });\n      logService.getLog(function (arr) {\n        $scope.bluetoothLog = arr;\n      });\n      //no need to connect or anything, connectToLastDevice is done on app startup\n      $scope.settings = shareSettings.getObj();\n      program = shareProgram.getObj();\n      console.log('program:');\n      console.log(JSON.stringify(program));\n      console.log('settings:');\n      console.log(JSON.stringify($scope.settings));\n      $scope.bluetoothLog = logService.getLog();\n      //runBluetoothVars is an object which contains settings commands (obj.commands)\n      // and individual variables (obj.vars.*)\n      calculateVarsService.getVars('runBluetooth', function (runBluetoothVars) {\n        commands = runBluetoothVars.commands;\n        console.log('commands:');\n        console.log(commands);\n      });\n      $scope.deviceName= connectToDeviceService.getDeviceName();\n      $scope.buttons = buttonService.getValues();\n        if (statusService.getEmergency() === true) {\n          console.log('set resetbutton true');\n          setButtons({'showResetButton': true});\n        }\n        else {\n          setButtons({\n            'showCalcButton': true,\n            'showMovingButton': false,\n            'showEmergency': false,\n            'readyForData': false,\n            'showSpinner': false\n          })\n        }\n      $scope.movements = [];\n      $scope.movementsNum = 0;\n      stepMotorNum = $scope.settings.stepMotorNum;\n    });\n\n    $scope.$on('$ionicView.leave',function () {\n      console.log('ionicView.leave called');\n      if (statusService.getSending() === true ) {\n        addToLog('Cancelling current tasks');\n        emergencyService.on(function () {\n          emergencyService.off();\n        });\n      }\n      else {\n        sendAndReceiveService.clearBuffer();\n\n      }\n      logService.setBulk($scope.bluetoothLog);\n    });\n\n    $scope.userDisconnect = function () {\n      disconnectService.disconnect();\n      $scope.isConnected = false;\n    };\n\n    //\n    //SECTION: Show buttons variables\n    //\n\n    function setButtons(obj) {\n      buttonService.setValues(obj);\n      $scope.$apply(function () {\n        $scope.buttons = buttonService.getValues()\n      });\n      console.log($scope.buttons);\n    }\n\n    //\n    //SECTION: UI log function\n    //\n\n    function addToLog(str) {\n      logService.addOne(str);\n      logService.getLog(function (arr) {\n        $scope.bluetoothLog = arr;\n      });\n    }\n\n    //\n    //SECTION: setting & resetting stop buttons\n    //\n\n    $rootScope.$on('emergencyOn', function () {\n      emergency = true;\n    });\n\n    $rootScope.$on('emergencyOff', function () {\n      emergency = false;\n      $scope.movements = [];\n      $scope.movementsNum = 0;\n      done = true;\n      settingsDone = true;\n      $scope.buttons = buttonService.getValues();\n    });\n\n    $scope.emergencyOn = function () {\n      emergencyService.on();\n    };\n\n    $scope.emergencyOff = function () {\n      statusService.setSending(false);\n      console.log('emergencyOff called');\n      emergencyService.off();\n    };\n\n    //\n    //SECTION: functions to determine movement steps\n    //\n\n    //function to add number of steps and description to $scope.movements\n    function addMovement(steps, descr) {\n      $scope.movements.push({\n        \"steps\": steps,\n        \"description\": descr\n      })\n    }\n\n    //calculate movement sequence\n    $scope.calcSteps = function() {\n      program = shareProgram.getObj();\n      $scope.settings = shareSettings.getObj();\n      $scope.movements = [];\n      //call function to calculate steps for cuts, subcuts and pins, log $scope.movements, callback to inform user of movements\n      if (program.sawWidth === undefined || program.cutWidth === undefined\n        || program.pinWidth === undefined || program.numberOfCuts === undefined) {\n        $ionicPopup.alert({\n          title: 'Please fill in your Program before continuing',\n          buttons: [{\n            text: 'Go to program',\n            type: 'button-calm',\n            onTap: function () {\n              $state.go('app.program');\n            }\n          }]\n        });\n      }\n      else if (program.sawWidth > program.cutWidth) {\n        $ionicPopup.alert({\n          title: 'Your saw width cannot be wider than your cut width',\n          template: 'Please adjust your program',\n          buttons: [{\n            text: 'Go to program',\n            type: 'button-positive',\n            onTap: function () {\n              $state.go('app.program');\n            }\n          }]\n        });\n      }\n      else {\n        cutsAndPins(function() {\n          console.log('Movements to take:');\n          var count= 1;\n          $scope.movements.forEach(function (item) {\n            console.log('Movement '+count+':'+' steps'+item.steps+', description: '+item.description);\n            count +=1;\n          })\n        });\n\n        function cutsAndPins(callback) {\n          //do this for number of cuts\n          for (var i = 1; i <= program.numberOfCuts; i++) {\n            console.log('var i ='+i);\n\n            //if cut width is wider than saw width, calculate subcuts (multiple subcuts needed to complete one cut)\n            if (program.cutWidth > program.sawWidth){\n\n              //how many subcuts do we need for this cut to complete\n              var subCuts = program.cutWidth / program.sawWidth;\n              var cutsRoundedUp = Math.ceil(subCuts);\n\n              // calculate remaining subcut steps, start at 2 because first subcut is already added after moving to past pin\n              for (var j=2; j<= cutsRoundedUp; j++){\n                console.log('Var j'+j);\n                if (j<cutsRoundedUp){\n                  var stepsPerSawWidth = program.sawWidth / $scope.settings.spindleAdvancement * $scope.settings.dipswitch;\n                  addMovement(stepsPerSawWidth, 'Make subcut '+j+'/'+cutsRoundedUp)\n                }\n\n                //calculate remaining mm & steps, based on number of subcuts already taken\n                else if (j===cutsRoundedUp) {\n                  var remainingMM = program.cutWidth-((j-1)*program.sawWidth);\n                  console.log('remaining mm: '+remainingMM);\n                  var remainingSteps = remainingMM / $scope.settings.spindleAdvancement * $scope.settings.dipswitch;\n                  addMovement(remainingSteps, 'Make subcut '+j+'/'+cutsRoundedUp);\n                }\n              }\n            }\n\n            //calculate steps for pins, not needed after last cut, thus i<numberOfCuts\n            if (i<program.numberOfCuts) {\n              console.log('Calculating pin');\n              var pinSteps = program.pinWidth / $scope.settings.spindleAdvancement * $scope.settings.dipswitch;\n              if (program.cutWidth > program.sawWidth) {\n                addMovement(pinSteps, 'Make subcut 1/'+cutsRoundedUp);\n              }\n              else if (program.cutWidth === program.sawWidth) {\n                addMovement(pinSteps, 'Make the cut');\n              }\n\n            }\n            if (i=== program.numberOfCuts){\n              console.log('i === numberofcuts');\n              addToLog('Done calculating movements');\n              console.log('$scope.movements:');\n              console.log($scope.movements);\n              if (callback) callback();\n              setButtons({\n                'showCalcButton': false,\n                'readyForData': true\n              })\n            }\n          }\n        }\n      }\n    };\n\n    //\n    //SECTION: send settings before homing, test and makeMovement logic\n    //\n\n    //user clicks button front end, sendSettingsData() called\n    $scope.sendSettingsData = function () {\n      if (statusService.getEmergency() === false) {\n        if (statusService.getSending() === false){\n          setButtons({'showSpinner':true,'showEmergency':true, 'readyForData':false});\n          statusService.setSending(true);\n          settingsDone = false;\n\n          for (var i = 0; i < commands.length -1; i++){\n            sendAndReceiveService.write(commands[i]);\n            }\n          //All other setting commands need to be sent before sending kFault,\n          // so on second to last setting command a 'sendKfault' is emitted after which kFault is sent\n          var sendKfault = $rootScope.$on('sendKfault', function () {\n            sendAndReceiveService.write(commands[commands.length-1], function () {\n              checkWydone();\n              sendKfault();\n            });\n            //on sending kFault, check for response\n          })\n        }\n          console.log('cannot continue sendSettingsData, sending is true')\n      }\n      else {\n        addToLog('Emergency on, will not continue sending settings data');\n      }\n    };\n\n    function checkWydone() {\n      var rdy = $rootScope.$on('bluetoothResponse', function (event, res) {\n        lastSendSettingsCommand(res);\n        rdy();\n      })\n    }\n\n    function lastSendSettingsCommand(res) {\n      if (res.search('rdy') !== -1) {\n        addToLog('Moving to start position');\n        sendAndReceiveService.write('<w'+stepMotorNum+'>', checkWydone());\n      }\n      else if (res.search('wydone') !== -1) {\n        setButtons({'readyForData':false,'showMovingButton':true,'showCalcButton':false,'showHoming':false, 'showSpinner': false});\n        statusService.setSending(false);\n        addToLog('Moved to start position');\n        var subCuts = program.cutWidth / program.sawWidth;\n        var cutsRoundedUp = Math.ceil(subCuts);\n        if (program.cutWidth !== program.sawWidth) {\n          $ionicPopup.alert({\n            title: 'Make the subcut 1/'+cutsRoundedUp\n          });\n        }\n        else {\n          $ionicPopup.alert({\n            title: 'Make the cut'\n          });\n        }\n      }\n      else if (res.search('kFAULT') !== -1){\n        addToLog('Settings have been sent incorrectly, please try again');\n        emergencyService.on(function () {\n          emergencyService.off()\n        });\n      }\n      else {\n        $timeout(function () {\n          sendAndReceiveService.write('<w'+stepMotorNum+'>', checkWydone());\n        }, 100)\n\n      }\n    }\n\n    //\n    //SECTION: startMoving \\ take steps logic\n    //\n\n    $scope.startMoving = function () {\n      console.log('$scope.movements in startMoving:');\n      console.log($scope.movements);\n      console.log('$scope.movementsNum in startMoving:');\n      console.log($scope.movementsNum);\n      if (statusService.getEmergency() === false) {\n        if (done) {\n          statusService.setSending(true);\n          done = false;\n          setButtons({'showSpinner':true});\n          sendAndReceiveService.write('<q'+$scope.movements[$scope.movementsNum].steps+stepMotorNum+'>', checkDone);\n        }\n        else {\n          addToLog('Please wait untill this step is finished');\n        }\n      }\n      else {\n        addToLog('Emergency on, will not continue with movement');\n      }\n\n      //check if prev stepCommand is done, send command, start pinging <w>, check for 'done:', allow next stepCommand\n      function checkDone() {\n        var check = $rootScope.$on('bluetoothResponse', function (event, res) {\n          console.log('on bluetoothResponse in checkDone called');\n            if (res.search('wydone:0') > -1) {\n              addToLog('Movement done');\n              addToLog($scope.movements[$scope.movementsNum].description);\n              done = true;\n              setButtons({'showSpinner':false, 'showHoming': true, 'showResetButton': false});\n              if ($scope.movements[$scope.movementsNum].description !== 'Moving to next cut'\n                && $scope.movementsNum !== $scope.movements.length -1){\n                $ionicPopup.alert({\n                  title: $scope.movements[$scope.movementsNum].description\n                });\n                $scope.movementsNum += 1;\n            }\n              //once last movement is completed show restart program popup\n              else if ($scope.movementsNum === $scope.movements.length -1) {\n                $ionicPopup.alert({\n                  title: $scope.movements[$scope.movementsNum].description,\n                  buttons: [{\n                    type: 'button-calm',\n                    text: 'OK',\n                    onTap: $scope.showRestartPopup()\n                  }]\n                });\n                setButtons({'showMovingButton':false,'showEmergency':false,'showResetButton':false});\n                statusService.setSending(false);\n                $scope.movements = [];\n                $scope.movementsNum = 0;\n              }\n            }\n          else {\n              $timeout(function () {\n                console.log('no wydone, sending <w>');\n                sendAndReceiveService.write('<w'+stepMotorNum+'>', checkDone);\n              }, 250);\n            }\n          check();\n        });\n      }\n    };\n\n    //\n    //SECTION: popups && modals\n    //\n    $scope.showRestartPopup = function () {\n      $ionicPopup.alert({\n        title: 'Program finished!',\n        template: 'Would you like to return to start position?',\n        buttons: [\n          {\n            text: 'Yes',\n            type: 'button-balanced',\n            onTap: function () {\n              $state.go('app.homing')\n            }\n          },\n          {\n            text: 'No',\n            type: 'button-calm',\n            onTap: function () {\n              setButtons({'showCalcButton': true})\n            }\n          },\n          {\n            text: 'Edit program',\n            type: 'button-positive',\n            onTap: function () {\n              $state.go('app.program');\n            }\n          }]\n      })\n    };\n\n\n    $scope.start = function () {\n      $ionicPopup.alert({\n        title: 'Make sure your workpiece is tightly secured!',\n        template: 'Program is about to start!',\n        buttons: [\n          {\n            text: 'Cancel',\n            type: 'button-positive'\n          },\n          {\n            text: 'Start',\n            type: 'button-balanced',\n            onTap: function () {\n              $scope.sendSettingsData()\n            }\n          }]\n      })\n    };\n\n    $scope.openHelpModal = function () {\n      modalService\n        .init('help-modal.html', $scope)\n        .then(function (modal) {\n          modal.show();\n        })\n    };\n\n    $scope.show = null;\n\n    $scope.showAnswer = function(obj) {\n      $scope.show = $scope.show === obj ? null : obj;\n    };\n\n    $scope.QAList = [];\n    for (var i=1; i<11; i++) {\n      $scope.QAList.push({\n        question: 'Question '+i,\n        answer: 'Lorem ipsum'\n      })\n    }\n\n    $scope.showFullLog = function () {\n      $scope.fullLog = $scope.bluetoothLog.slice(0,19);\n      modalService\n        .init('log-modal.html', $scope)\n        .then(function (modal) {\n          modal.show();\n        })\n    };\n\n    $scope.emailFullLog = function () {\n      logModalService.emailFullLog();\n    } ;\n\n    $scope.fullLog = $scope.bluetoothLog.slice(0,19);\n\n    $scope.fullLogPage = 0;\n\n    $scope.getFullLogExtract = function(start, end) {\n      console.log('getFullLogExtract, start: '+start+' end: '+end);\n      $scope.fullLog = $scope.bluetoothLog.slice(start, end)\n    };\n\n    $scope.previousFullLogPage = function () {\n      console.log('prevFullLogPage');\n      $scope.getFullLogExtract((($scope.fullLogPage-1)*10),(($scope.fullLogPage-1)*10)+9);\n      $scope.fullLogPage -= 1;\n    };\n\n    $scope.nextFullLogPage = function () {\n      console.log('nextFullLogPage');\n      $scope.getFullLogExtract((($scope.fullLogPage+1)*10),(($scope.fullLogPage+1)*10)+9);\n      $scope.fullLogPage += 1;\n    };\n  })\n//end of controller runBluetoothCtrl\n\n.controller('homingCtrl', function ($rootScope, $scope, $cordovaClipboard, $cordovaBluetoothSerial, $ionicPopup, $ionicModal,\n                                    $state, $ionicPlatform, $window, $interval, $timeout, shareSettings, shareProgram, skipService, buttonService, emergencyService,\n                                    checkBluetoothEnabledService, isConnectedService, logService, disconnectService, calculateVarsService, sendAndReceiveService,\n                                    statusService, connectToDeviceService, $ionicHistory, logModalService, modalService) {\n  $scope.$on('$ionicView.unloaded', function () {\n    console.log('\\nUNLOADED\\n');\n  });\n\n  $scope.$on('$ionicView.beforeLeave', function () {\n    console.log('BEFORE LEAVE');\n    sendAndReceiveService.unsubscribe();\n  });\n\n  $scope.$on('$ionicView.afterEnter', function () {\n    console.log('AFTER ENTER');\n    sendAndReceiveService.subscribe();\n  });\n\n  var homingStopswitchInt;\n  //homing commands\n  var homingCommands;\n  $scope.settings = shareSettings.getObj();\n  var stepMotorNum = $scope.settings.stepMotorNum;\n  $scope.bluetoothLog = [];\n  $scope.bluetoothEnabled = null;\n  $scope.buttons = buttonService.getValues();\n  $scope.userDisconnect = function () {\n    disconnectService.disconnect();\n    isConnectedService.getValue(function (val) {\n      $scope.isConnected = val;\n    })\n  };\n\n  function setButtons(obj) {\n    buttonService.setValues(obj);\n    $scope.$apply(function () {\n      $scope.buttons = buttonService.getValues()\n    });\n    console.log($scope.buttons);\n  }\n\n  $scope.$on('$ionicView.enter', function () {\n    console.log('enterView in homingCtrl fired');\n    logService.getLog(function (arr) {\n      $scope.bluetoothLog = arr;\n    });\n    checkBluetoothEnabledService.getValue(function (value) {\n      $scope.bluetoothEnabled = value;\n      console.log('$scope.bluetoothEnabled: '+$scope.bluetoothEnabled);\n    });\n    connectToDeviceService.getDeviceName(function (value) {\n      $scope.deviceName= value;\n    });\n    $scope.buttons = buttonService.getValues();\n    isConnectedService.getValue(function (value) {\n      $scope.isConnected = value;\n      console.log('$scope.isConnected: '+$scope.isConnected);\n    });\n    calculateVarsService.getVars('homing', function (obj) {\n      homingCommands = obj.commands;\n      console.log('homingcommands:');\n      console.log(homingCommands);\n      homingStopswitchInt = obj.vars.homingStopswitchInt;\n    });\n    $scope.settings = shareSettings.getObj();\n    stepMotorNum = $scope.settings.stepMotorNum;\n  });\n\n  $scope.$on('$ionicView.leave', function () {\n    console.log('leaveView in bluetoothConnectionCtrl fired');\n    if (statusService.getSending() === true ) {\n      addToLog('Cancelling current tasks');\n      emergencyService.on(function () {\n        emergencyService.off();\n      });\n    }\n    else {\n\n      sendAndReceiveService.clearBuffer();\n    }\n    //TODO perhaps create listeners in a var and cancel var on leave?\n    logService.setBulk($scope.bluetoothLog);\n  });\n\n  $scope.emergencyOn = function () {\n    emergencyService.on();\n  };\n\n  $scope.emergencyOff = function () {\n    console.log('emergencyOff called');\n    emergencyService.off();\n  };\n\n  //\n  //SECTION: homing logic\n  //\n\n  $scope.homing = function () {\n    if (statusService.getEmergency() === false) {\n      console.log('homingStopswitch = '+homingStopswitchInt);\n      if (statusService.getSending() === false){\n        setButtons({'showSpinner':true,'showEmergency':true,'showHoming':false});\n        statusService.setSending(true);\n        //send start command\n        for (var i = 0; i < homingCommands.length -1; i++){\n          sendAndReceiveService.write(homingCommands[i]);\n        }\n        var sendKfault = $rootScope.$on('sendKfault', function () {\n          sendAndReceiveService.write(homingCommands[homingCommands.length-1], function () {\n            sendKfault();\n          });\n        });\n        var rdy = $rootScope.$on('bluetoothResponse', function (event, res) {\n          homingResponse(res);\n          rdy();\n        })\n      }\n      else {\n        $ionicPopup.alert({\n          title: 'Please wait untill moving to start position is done in run Bluetooth program'\n        });\n      }\n    }\n    else {\n      $ionicPopup.alert({\n        title: 'Emergency has been pressed, will not continue homing'\n      });\n    }\n\n//TODO !!! Check real-life homing correct handling, using my STM-32 stopswitch is automatically hit, not able to check correct homing\"\n    function homingResponse(res) {\n      if (res.search('wydone') > -1 && $ionicHistory.currentStateName() === 'app.homing') {\n        setButtons({'showSpinner': false, 'showEmergency': false, 'showHoming': true});\n        $ionicPopup.alert({\n          title: 'Homing completed'\n        });\n        statusService.setSending(false);\n      }\n      else if ($ionicHistory.currentStateName() === 'app.homing') {\n        $timeout(function () {\n          sendAndReceiveService.write('<w'+stepMotorNum+'>');\n          var rdy = $rootScope.$on('bluetoothResponse', function (event, res) {\n            homingResponse(res);\n            rdy();\n          })\n        }, 200);\n      }\n    }\n  };\n\n  function addToLog(str) {\n    logService.addOne(str);\n    logService.getLog(function (arr) {\n      $scope.bluetoothLog = arr;\n    });\n  }\n\n  $scope.openHelpModal = function () {\n    modalService\n      .init('help-modal.html', $scope)\n      .then(function (modal) {\n        modal.show();\n      })\n  };\n\n  $scope.show = null;\n\n  $scope.showAnswer = function(obj) {\n    $scope.show = $scope.show === obj ? null : obj;\n  };\n\n  $scope.QAList = [];\n  for (var i=1; i<11; i++) {\n    $scope.QAList.push({\n      question: 'Question '+i,\n      answer: 'Lorem ipsum'\n    })\n  }\n\n  $scope.showFullLog = function () {\n    $scope.fullLog = $scope.bluetoothLog.slice(0,19);\n    modalService\n      .init('log-modal.html', $scope)\n      .then(function (modal) {\n        modal.show();\n      })\n  };\n\n  $scope.emailFullLog = function () {\n    logModalService.emailFullLog();\n  } ;\n\n  $scope.fullLog = $scope.bluetoothLog.slice(0,19);\n\n  $scope.fullLogPage = 0;\n\n  $scope.getFullLogExtract = function(start, end) {\n    console.log('getFullLogExtract, start: '+start+' end: '+end);\n    $scope.fullLog = $scope.bluetoothLog.slice(start, end)\n  };\n\n  $scope.previousFullLogPage = function () {\n    console.log('prevFullLogPage');\n    $scope.getFullLogExtract((($scope.fullLogPage-1)*10),(($scope.fullLogPage-1)*10)+9);\n    $scope.fullLogPage -= 1;\n  };\n\n  $scope.nextFullLogPage = function () {\n    console.log('nextFullLogPage');\n    $scope.getFullLogExtract((($scope.fullLogPage+1)*10),(($scope.fullLogPage+1)*10)+9);\n    $scope.fullLogPage += 1;\n  };\n\n})\n//end of controller homingCtrl\n\n.controller('testCtrl', function ($rootScope, $scope, $cordovaClipboard, $cordovaBluetoothSerial, $ionicPopup, $ionicModal,\n                                  $state, $ionicPlatform, $window, $interval, $timeout, shareSettings, shareProgram, skipService, buttonService, emergencyService,\n                                  checkBluetoothEnabledService, isConnectedService, logService, disconnectService, calculateVarsService, sendAndReceiveService,\n                                  statusService, connectToDeviceService, logModalService, modalService) {\n  $scope.$on('$ionicView.unloaded', function () {\n    console.log('\\nUNLOADED\\n');\n  });\n\n  $scope.$on('$ionicView.beforeLeave', function () {\n    console.log('BEFORE LEAVE');\n    sendAndReceiveService.unsubscribe();\n  });\n\n  $scope.$on('$ionicView.afterEnter', function () {\n    console.log('AFTER ENTER');\n    sendAndReceiveService.subscribe();\n  });\n\n//other vars/commands\n  var commands;\n  $scope.settings = shareSettings.getObj();\n  var stepMotorNum = $scope.settings.stepMotorNum;\n  var softwareVersionCommand = '<z'+stepMotorNum+'>';\n  $scope.bluetoothLog = [];\n  $scope.bluetoothEnabled = null;\n  $scope.buttons = buttonService.getValues();\n  $scope.retriesNeeded = 0;\n  $scope.completedTest = 0;\n  var sentSettingsForTest = false;\n  $scope.numberOfTests = {};\n  var testsSent = 0;\n  $scope.testRunning = false;\n\n  $scope.userDisconnect = function () {\n    disconnectService.disconnect();\n    isConnectedService.getValue(function (val) {\n      $scope.isConnected = val;\n    })\n  };\n\n  function setButtons(obj) {\n    buttonService.setValues(obj);\n    $scope.$apply(function () {\n      $scope.buttons = buttonService.getValues()\n    });\n    console.log($scope.buttons);\n  }\n\n  $scope.$on('$ionicView.enter', function () {\n    console.log('enterView in testCtrl fired');\n    logService.getLog(function (arr) {\n      $scope.bluetoothLog = arr;\n    });\n    checkBluetoothEnabledService.getValue(function (value) {\n      $scope.bluetoothEnabled = value;\n      console.log('$scope.bluetoothEnabled: '+$scope.bluetoothEnabled);\n    });\n    connectToDeviceService.getDeviceName(function (value) {\n      $scope.deviceName= value;\n    });\n    $scope.buttons = buttonService.getValues();\n    isConnectedService.getValue(function (value) {\n      $scope.isConnected = value;\n      console.log('$scope.isConnected: '+$scope.isConnected);\n    });\n    calculateVarsService.getVars('test', function (obj) {\n      commands = obj.commands;\n      console.log('testCommands:');\n      console.log(commands);\n    });\n    $scope.settings = shareSettings.getObj();\n    stepMotorNum = $scope.settings.stepMotorNum;\n  });\n\n  $scope.$on('$ionicView.leave', function () {\n    console.log('leaveView in bluetoothConnectionCtrl fired');\n    $scope.retriesNeeded = 0;\n    $scope.completedTest = 0;\n    sentSettingsForTest = false;\n    $scope.numberOfTests = {};\n    testsSent = 0;\n    $scope.testRunning = false;\n    if (statusService.getSending() === true ) {\n      addToLog('Cancelling current tasks');\n      emergencyService.on(function () {\n        emergencyService.off();\n      });\n    }\n    else {\n\n      sendAndReceiveService.clearBuffer();\n    }\n    logService.setBulk($scope.bluetoothLog);\n  });\n\n  $scope.emergencyOn = function () {\n    emergencyService.on();\n    $scope.completedTest = 0;\n    $scope.retriesNeeded = 0;\n    sentSettingsForTest = false;\n    testsSent = 0;\n    $scope.testRunning = false;\n    sendKfault();\n    rdy();\n    rdy2();\n    listen();\n    newCommand();\n    nextListener();\n  };\n\n  $scope.emergencyOff = function () {\n    console.log('emergencyOff called');\n    emergencyService.off();\n\n  };\n  //\n  //SECTION: stressTest && move X mm logic\n  //\n\n  $scope.moveXMm = function () {\n    if (statusService.getEmergency() === false && statusService.getSending() === false) {\n      if ($scope.numberOfTests.mm === undefined) {\n        $ionicPopup.alert({\n          title: 'Please fill in \"Move X mm\"'\n        })\n      }\n      else {\n        setButtons({'showStressTest': false, 'showVersionButton': false, 'showSpinner':true, 'showEmergency': true});\n\n        //replace standard <s0+stepMotorNum> with moveXMmStepsCommand\n        var moveXMmSteps = $scope.numberOfTests.mm / $scope.settings.spindleAdvancement * $scope.settings.dipswitch;\n        var moveXMmStepsCommand = '<s'+moveXMmSteps+stepMotorNum+'>';\n        var position = commands.indexOf('<s0'+stepMotorNum+'>');\n        commands[position] = moveXMmStepsCommand;\n        sendSettings('moveXMm');\n      }\n    }\n  };\n\n  var sendKfault;\n  var rdy;\n  var rdy2;\n  var listen;\n  var newCommand;\n\n\n  function sendSettings(type) {\n    var typeStr = type;\n    console.log('Commands in testCtrl -> sendSettings:');\n    console.log(commands);\n    //send commands, except last one\n    for (var i = 0; i < commands.length -1; i++){\n      sendAndReceiveService.write(commands[i]);\n    }\n    //send last command on sendKfault notification\n    sendKfault = $rootScope.$on('sendKfault', function () {\n      sendAndReceiveService.write(commands[commands.length-1], function () {\n        initRdy(typeStr);\n        sendKfault();\n      });\n    });\n    //check if commands have been sent correctly\n  }\n\n  function initRdy(typeStr) {\n    rdy = $rootScope.$on('bluetoothResponse', function (event, res) {\n      checkRdy(res, typeStr);\n      rdy();\n    });\n  }\n\n  function checkRdy(res, type) {\n    var typeStr = type;\n    if (res.search('wydone') > -1) {\n      if (typeStr === 'moveXMm') {\n        $ionicPopup.alert({\n          title: 'Moved '+$scope.numberOfTests.mm+' mm'\n        });\n        setButtons({'showStressTest': true, 'showVersionButton': true, 'showEmergency': false, 'showSpinner': false});\n        calculateVarsService.getVars('test', function (obj) {\n          console.log('resetting commands in testCtrl');\n          commands = obj.commands;\n        });\n      }\n      else if (typeStr === 'stressTest') {\n        addToLog('Executing tests');\n        sentSettingsForTest = true;\n        $scope.stressTest();\n      }\n    }\n    else if (res.search('FAULT') > -1) {\n      addToLog('Error sending moveXMmResponse, aborting current task & resetting');\n      emergencyService.on(function () {\n        emergencyService.off();\n      })\n    }\n    else {\n      $timeout(function () {\n        sendAndReceiveService.write('<w'+stepMotorNum+'>');\n        rdy2 = $rootScope.$on('bluetoothResponse', function (event, response) {\n          checkRdy(response, typeStr);\n          rdy2();\n        })\n      }, 200);\n    }\n  }\n\n  //TODO tried to work with buffered commands, did not work, reverting back to one at a time\n  $scope.stressTest = function () {\n    if (statusService.getEmergency() === true) {\n      addToLog('Emergency on, cancelling stresstest');\n    }\n    else if ($scope.numberOfTests.tests === undefined || $scope.numberOfTests.tests === 0) {\n      $ionicPopup.alert({\n        title: 'Please fill in the number of test commands'\n      })\n    }\n    else {\n      setButtons({'showEmergency': true, 'showResetButton': false, 'showStressTest': false, 'showVersionButton': false, 'showMoveXMm': false, 'showSpinner': true});\n      $scope.testRunning = true;\n      if (!sentSettingsForTest) {\n        if (statusService.getEmergency() === false) {\n          console.log('numberOfTests:'+$scope.numberOfTests.tests);\n          addToLog('Sending settings needed for testing');\n          sendSettings('stressTest');\n        }\n      }\n      else {\n        if (statusService.getEmergency() === false) {\n          statusService.setSending(true);\n\n          //with 10 or less tests, send them all at once\n          if (testsSent < $scope.numberOfTests.tests) {\n            //Send a random command, true = create listener, function is executed as soon as wydone+commandID has come back\n              $timeout(function () {\n                send('<q'+Math.floor((Math.random()*1000)+20) +stepMotorNum+'>', sendNext);\n              }, 150);\n          }\n        }\n        else {\n          addToLog('Emergency on, will not continue with stresstest');\n        }\n      }\n    }\n  };\n\n  var nextListener;\n  function sendNext() {\n    nextListener = $rootScope.$on('bluetoothResponse', function (event, res) {\n      if ($scope.numberOfTests.tests === testsSent && res.search('wydone')) {\n        $scope.completedTest +=1;\n        $ionicPopup.alert({\n          title: 'Tests completed',\n          template: 'Completed '+$scope.completedTest+' out of '+$scope.numberOfTests.tests\n        });\n        setButtons({'showEmergency':false, 'showSpinner': false, 'showStressTest':true, 'showVersionButton': true, 'showMoveXMm': true});\n        $scope.testRunning = false;\n        addToLog('Tests completed');\n        console.log('completed tests: '+$scope.completedTest+' number of tests: '+$scope.numberOfTests.tests+' sent tests: '+testsSent);\n        sentSettingsForTest = false;\n        statusService.setSending(false);\n        nextListener();\n      }\n      else if (res.search('wydone') > -1) {\n        $scope.completedTest +=1;\n        $scope.stressTest();\n        nextListener();\n      }\n      else {\n        $timeout(function () {\n          sendAndReceiveService.write('<w'+stepMotorNum+'>', sendNext);\n        }, 200);\n        nextListener();\n      }\n    })\n  }\n\n  function send(str, cb) {\n    if (str === undefined){\n      $ionicPopup.alert({\n        title: 'Encountered an error',\n        template: 'Please email a bug report via \\'Show full log\\''\n      })\n    }\n    if (statusService.getEmergency() === false) {\n      //calling .write() with original command (str). callingFunction is optional.\n      sendAndReceiveService.write(str);\n      testsSent += 1;\n      if (cb) cb();\n    }\n  }\n\n  $scope.getVersion = function() {\n    if (statusService.getEmergency() === false && statusService.getSending() === false){\n      sendAndReceiveService.write('<<y8:y'+stepMotorNum+'>');\n      sendAndReceiveService.write(softwareVersionCommand, function () {\n        listen = $rootScope.$on('bluetoothResponse', function (event, res) {\n          if (res.search('<14:') > -1) {\n            $ionicPopup.alert({\n              title: 'Version number',\n              template: 'Your version number is: '+res.slice(res.lastIndexOf(':')+1,res.lastIndexOf('>'))\n            });\n            listen();\n          }\n        })\n      });\n    }\n  };\n\n  function addToLog(str) {\n    logService.addOne(str);\n    logService.getLog(function (arr) {\n      $scope.bluetoothLog = arr;\n    });\n  }\n\n  $scope.openHelpModal = function () {\n    modalService\n      .init('help-modal.html', $scope)\n      .then(function (modal) {\n        modal.show();\n      })\n  };\n\n  $scope.show = null;\n\n  $scope.showAnswer = function(obj) {\n    $scope.show = $scope.show === obj ? null : obj;\n  };\n\n  $scope.QAList = [];\n  for (var i=1; i<11; i++) {\n    $scope.QAList.push({\n      question: 'Question '+i,\n      answer: 'Lorem ipsum'\n    })\n  }\n\n  $scope.showFullLog = function () {\n    $scope.fullLog = $scope.bluetoothLog.slice(0,19);\n    modalService\n      .init('log-modal.html', $scope)\n      .then(function (modal) {\n        modal.show();\n      })\n  };\n\n  $scope.emailFullLog = function () {\n    logModalService.emailFullLog();\n  } ;\n\n  $scope.fullLog = $scope.bluetoothLog.slice(0,19);\n\n  $scope.fullLogPage = 0;\n\n  $scope.getFullLogExtract = function(start, end) {\n    console.log('getFullLogExtract, start: '+start+' end: '+end);\n    $scope.fullLog = $scope.bluetoothLog.slice(start, end)\n  };\n\n  $scope.previousFullLogPage = function () {\n    console.log('prevFullLogPage');\n    $scope.getFullLogExtract((($scope.fullLogPage-1)*10),(($scope.fullLogPage-1)*10)+9);\n    $scope.fullLogPage -= 1;\n  };\n\n  $scope.nextFullLogPage = function () {\n    console.log('nextFullLogPage');\n    $scope.getFullLogExtract((($scope.fullLogPage+1)*10),(($scope.fullLogPage+1)*10)+9);\n    $scope.fullLogPage += 1;\n  };\n})\n//end of controller testCtrl\n\n.controller('bluetoothConnectionCtrl', function ($rootScope, $scope, $cordovaClipboard, $cordovaBluetoothSerial, $ionicPopup, $ionicModal,\n                                                 $state, $ionicPlatform, $window, turnOnBluetoothService, statusService, isConnectedService, logService,\n                                                 buttonService, checkBluetoothEnabledService, connectToDeviceService, disconnectService, $timeout, logModalService, modalService) {\n\n  $scope.availableDevices = [];\n  $scope.pairedDevices = [];\n  logService.getLog(function (arr) {\n    $scope.bluetoothLog = arr;\n  });\n  $scope.bluetoothOn = function () {\n    turnOnBluetoothService.turnOn(function () {\n      checkBluetoothEnabledService.getValue(function (val) {\n        $scope.bluetoothEnabled = val;\n        if ($scope.bluetoothEnabled) $scope.getAvailableDevices();\n      })\n    });\n  };\n  checkBluetoothEnabledService.getValue(function (val) {\n    $scope.bluetoothEnabled = val;\n  });\n  $scope.deviceName= connectToDeviceService.getDeviceName();\n  $scope.buttons = buttonService.getValues();\n  $scope.isConnected = isConnectedService.getValue();\n\n  function addToLog(str) {\n    console.log(str);\n    logService.addOne(str);\n    logService.getLog(function (arr) {\n      $scope.bluetoothLog = arr;\n    })\n  }\n\n  function setButtons(obj) {\n    buttonService.setValues(obj);\n    $scope.buttons = buttonService.getValues();\n  }\n\n  $scope.$on('$ionicView.enter', function () {\n    $scope.availableDevices = [];\n    $scope.pairedDevices = [];\n    console.log('enterView in bluetoothConnectionCtrl fired');\n    logService.getLog(function (arr) {\n      $scope.bluetoothLog = arr;\n    });\n    checkBluetoothEnabledService.getValue(function (value) {\n      $scope.bluetoothEnabled = value;\n      console.log('$scope.bluetoothEnabled: '+$scope.bluetoothEnabled);\n    });\n    connectToDeviceService.getDeviceName(function (value) {\n      $scope.deviceName= value;\n    });\n    $scope.buttons = buttonService.getValues();\n    isConnectedService.getValue(function (value) {\n      $scope.isConnected = value;\n      console.log('$scope.isConnected: '+$scope.isConnected);\n      if (!$scope.isConnected) {\n        console.log('connected false, calling getAvailableDevices');\n        $scope.getAvailableDevices();\n      }\n    });\n  });\n\n  $scope.userDisconnect = function () {\n    disconnectService.disconnect();\n    $scope.isConnected = false;\n    $timeout(function () {\n      $scope.getAvailableDevices();\n    }, 500);\n\n  };\n\n  $scope.$on('$ionicView.leave', function () {\n    console.log('leaveView in bluetoothConnectionCtrl fired');\n    logService.setBulk($scope.bluetoothLog);\n  });\n\n  $scope.getAvailableDevices = function () {\n    $scope.availableDevices = [];\n    $scope.pairedDevices = [];\n    isConnectedService.getValue(function (value) {\n      if (value === false) {\n        $ionicPlatform.ready(function() {\n          console.log('Calling get available devices');\n          if (ionic.Platform.isAndroid) {\n            //discover unpaired\n            $cordovaBluetoothSerial.discoverUnpaired().then(function (devices) {\n              addToLog('Searching for unpaired Bluetooth devices');\n              devices.forEach(function (device) {\n                  $scope.availableDevices.push(device);\n                  addToLog('Unpaired Bluetooth device found');\n                }\n              )}, function () {\n              addToLog('Cannot find unpaired Bluetooth devices');\n            });\n            //discover paired\n            $cordovaBluetoothSerial.list().then(function (devices) {\n              addToLog('Searching for paired Bluetooth devices');\n              devices.forEach(function (device) {\n                $scope.pairedDevices.push(device);\n                addToLog('Paired Bluetooth device found');\n              })\n            },function () {\n              addToLog('Cannot find paired Bluetooth devices');\n            })\n          }\n          else if (ionic.Platform.isIOS) {\n            $cordovaBluetoothSerial.list().then(function (devices) {\n              addToLog('Searching for Bluetooth devices');\n              devices.forEach(function (device) {\n                addToLog('Bluetooth device found');\n                $scope.availableDevices.push(device);\n              })\n            }, function () {\n              addToLog('No devices found');\n            })\n          }\n        })\n      }\n    })\n\n\n  };\n\n  $scope.connectToUnpairedDevice = function ($index) {\n    $ionicPlatform.ready(function() {\n      addToLog('Trying to connect');\n      console.log('Id = '+$scope.availableDevices[$index].id);\n      $cordovaBluetoothSerial.connectInsecure($scope.availableDevices[$index].id).then(function () {\n          addToLog('Your smartphone has succesfully connected with the selected Bluetooth device');\n        saveLastConnectedDevice($scope.availableDevices[$index].id, $scope.availableDevices[$index].name);\n        connectToDeviceService.setDeviceName($scope.availableDevices[$index].name);\n          isConnectedService.getValue(function (val) {\n            $timeout(function () {\n              $scope.$apply(function () {\n                $scope.isConnected = val;\n              })\n            }, 500);\n\n          });\n\n        }, function (error) {\n          //failure callback\n          addToLog('Your smartphone has not been able to connect or has lost connection with the selected Bluetooth device');\n          addToLog('error: '+error);\n          $scope.isConnected = isConnectedService.getValue();\n        })\n    })\n  };\n\n  $scope.connectToPairedDevice = function ($index) {\n    $ionicPlatform.ready(function() {\n      addToLog('Trying to connect');\n      console.log('Id = '+$scope.pairedDevices[$index].id);\n      $cordovaBluetoothSerial.connect($scope.pairedDevices[$index].id).then(function () {\n        saveLastConnectedDevice($scope.pairedDevices[$index].id, $scope.pairedDevices[$index].name);\n        connectToDeviceService.setDeviceName($scope.pairedDevices[$index].name);\n        addToLog('Your smartphone has succesfully connected with the selected Bluetooth device');\n        isConnectedService.getValue(function (val) {\n          $timeout(function () {\n            $scope.$apply(function () {\n              $scope.isConnected = val;\n            })\n          }, 500);\n\n        });\n      }, function (error) {\n        addToLog('Your smartphone has not been able to connect or has lost connection with the selected Bluetooth device');\n        addToLog('error: '+error);\n      })\n    })\n  };\n\n  function saveLastConnectedDevice(id, name) {\n    var obj = {'id':id,'name':name};\n    $scope.deviceName = name;\n    window.localStorage.setItem('lastConnectedDevice', JSON.stringify(obj));\n    console.log('Local storage last connected device set to: '+window.localStorage['lastConnectedDevice']);\n    showSavedDeviceAlert();\n  }\n\n  function addToLog(str) {\n    logService.addOne(str);\n    logService.getLog(function (arr) {\n      $scope.bluetoothLog = arr;\n    });\n  }\n\n  function showSavedDeviceAlert() {\n      $ionicPopup.alert({\n        title: 'Bluetooth device saved',\n        template: 'This bluetooth device is saved and will connect automatically from now on.<br \\>If you need to change your device later on choose a new device via Bluetooth connection in the menu',\n        buttons: [{\n          text: 'Go to program',\n          type: 'button-calm',\n          onTap: function () {\n            $state.go('app.program')\n          }\n        },\n          {\n            text: 'Close'\n          }\n        ]\n      })\n  }\n\n  $scope.openHelpModal = function () {\n    modalService\n      .init('help-modal.html', $scope)\n      .then(function (modal) {\n        modal.show();\n      })\n  };\n\n  $scope.show = null;\n\n  $scope.showAnswer = function(obj) {\n    $scope.show = $scope.show === obj ? null : obj;\n  };\n\n  $scope.QAList = [];\n  for (var i=1; i<11; i++) {\n    $scope.QAList.push({\n      question: 'Question '+i,\n      answer: 'Lorem ipsum'\n    })\n  }\n\n  $scope.showFullLog = function () {\n    $scope.fullLog = $scope.bluetoothLog.slice(0,19);\n    modalService\n      .init('log-modal.html', $scope)\n      .then(function (modal) {\n        modal.show();\n      })\n  };\n\n  $scope.emailFullLog = function () {\n    logModalService.emailFullLog();\n  } ;\n\n  $scope.fullLog = $scope.bluetoothLog.slice(0,19);\n\n  $scope.fullLogPage = 0;\n\n  $scope.getFullLogExtract = function(start, end) {\n    console.log('getFullLogExtract, start: '+start+' end: '+end);\n    $scope.fullLog = $scope.bluetoothLog.slice(start, end)\n  };\n\n  $scope.previousFullLogPage = function () {\n    console.log('prevFullLogPage');\n    $scope.getFullLogExtract((($scope.fullLogPage-1)*10),(($scope.fullLogPage-1)*10)+9);\n    $scope.fullLogPage -= 1;\n  };\n\n  $scope.nextFullLogPage = function () {\n    console.log('nextFullLogPage');\n    $scope.getFullLogExtract((($scope.fullLogPage+1)*10),(($scope.fullLogPage+1)*10)+9);\n    $scope.fullLogPage += 1;\n  };\n});\n//end of controller bluetoothConnectionCtrl\n\n\n\n// WEBPACK FOOTER //\n// ./C:/Users/Patrick/WebstormProjects/Toothmaster/es6/controllers.js","let crcTableStr = '0 4129 8258 12387 16516 20645 24774 28903 33032 37161 41290 45419 49548 53677 57806 61935 4657 528 12915 8786 21173 17044 29431 25302 37689 33560 45947 41818 54205 50076 62463 58334 9314 13379 1056 5121 25830 29895 17572 21637 42346 46411 34088 38153 58862 62927 50604 54669 13907 9842 5649 1584 30423 26358 22165 18100 46939 42874 38681 34616 63455 59390 55197 51132 18628 22757 26758 30887 2112 6241 10242 14371 51660 55789 59790 63919 35144 39273 43274 47403 23285 19156 31415 27286 6769 2640 14899 10770 56317 52188 64447 60318 39801 35672 47931 43802 27814 31879 19684 23749 11298 15363 3168 7233 60846 64911 52716 56781 44330 48395 36200 40265 32407 28342 24277 20212 15891 11826 7761 3696 65439 61374 57309 53244 48923 44858 40793 36728 37256 33193 45514 41451 53516 49453 61774 57711 4224 161 12482 8419 20484 16421 28742 24679 33721 37784 41979 46042 49981 54044 58239 62302 689 4752 8947 13010 16949 21012 25207 29270 46570 42443 38312 34185 62830 58703 54572 50445 13538 9411 5280 1153 29798 25671 21540 17413 42971 47098 34713 38840 59231 63358 50973 55100 9939 14066 1681 5808 26199 30326 17941 22068 55628 51565 63758 59695 39368 35305 47498 43435 22596 18533 30726 26663 6336 2273 14466 10403 52093 56156 60223 64286 35833 39896 43963 48026 19061 23124 27191 31254 2801 6864 10931 14994 64814 60687 56684 52557 48554 44427 40424 36297 31782 27655 23652 19525 15522 11395 7392 3265 61215 65342 53085 57212 44955 49082 36825 40952 28183 32310 20053 24180 11923 16050 3793 7920';\nlet crcTable = crcTableStr.split(' ');\n\nlet crcTableHex = [];\n\ncrcTable.map((str, i) => {\n  crcTableHex.push(parseInt(str, 10))\n});\n\nfunction crc16(s) {\n  var returnObj = {};\n  var crc = 0xFFFF;\n  var j, i;\n\n\n  for (i = 0; i < s.length; i++) {\n\n    let c = s.charCodeAt(i);\n    if (c > 255) {\n      throw new RangeError();\n    }\n    j = (c ^ (crc >> 8)) & 0xFF;\n    crc = crcTable[j] ^ (crc << 8);\n  }\n\n  returnObj.Uint16 = ((crc ^ 0) & 0xFFFF);\n\n  returnObj.Uint8High = ((returnObj.Uint16 >> 8) & 0xff);\n  returnObj.Uint8Low = returnObj.Uint16 & 0xff;\n\n  return returnObj;\n\n}\n\nmodule.exports = crc16;\n\n\n\n// WEBPACK FOOTER //\n// ./C:/Users/Patrick/WebstormProjects/Toothmaster/es6/crc16.js","/**\n * Created by Patrick on 22/11/2016.\n */\nmodule.exports = sendAndReceiveService;\n  // angular\n  //   .module('Toothmaster')\n  //   .service('sendAndReceiveService', sendAndReceiveService);\n  //\n  // sendAndReceiveService.$inject = ['statusService', 'emergencyService', '$window', 'logService',\n  //   '$rootScope', 'buttonService', 'crcService', '$ionicPopup', 'shareSettings', '$interval', '$timeout'];\n\n  function sendAndReceiveService(statusService, emergencyService, $window, logService, $rootScope,\n                                 buttonService, crcService, $ionicPopup, shareSettings, $interval, $timeout) {\n    const sendAndReceive = this;\n    //Available methods\n    sendAndReceive.subscribe = subscribe;\n    sendAndReceive.subscribeRawData = subscribeRawData;\n    sendAndReceive.unsubscribe = unsubscribe;\n    sendAndReceive.write = write;\n    sendAndReceive.writeBuffered = writeBuffered;\n    sendAndReceive.checkInterpretedResponse = checkInterpretedResponse;\n    sendAndReceive.startPing = startPing;\n    sendAndReceive.stopPing = stopPing;\n    sendAndReceive.getNewCommandID = getNewCommandID;\n    sendAndReceive.setCommandID = setCommandID;\n    sendAndReceive.resetCommandObj = resetCommandObj;\n    sendAndReceive.expectedResponse = expectedResponse;\n    sendAndReceive.addToCommandObj = addToCommandObj;\n    sendAndReceive.emitResponse = emitResponse;\n    sendAndReceive.sendEmergency = sendEmergency;\n    sendAndReceive.createResetListener = createResetListener;\n    sendAndReceive.clearBuffer = clearBuffer;\n\n    //emergency listener\n    $rootScope.$on('emergencyOn', function () {\n      sendAndReceive.stopPing();\n      sendAndReceive.sendEmergency();\n      sendAndReceive.resetCommandObj();\n    });\n\n    //service-scoped variables\n    var stepMotorNum = shareSettings.getObj().stepMotorNum;\n    var command;\n    var response;\n    var lastCommandTime;\n    var lastReceivedTime;\n    var subscribed = statusService.getSubscribed();\n    var commandIdStr = $window.localStorage['commandIdNum'];\n    var commandObj = {};\n    var ping;\n\n    //method functions\n    function subscribe() {\n      logService.consoleLog('subscribed');\n      statusService.setSubscribed(true);\n      $window.bluetoothSerial.subscribe('#', function (data) {\n        lastReceivedTime = Date.now();\n        sendAndReceive.emitResponse(data);\n      });\n    }\n\n    function subscribeRawData() {\n      $window.bluetoothSerial.subscribeRawData(function (data) {\n        var bytes = String.fromCharCode.apply(null, new Uint8Array(data));\n        logService.consoleLog('Rawdata: '+bytes);\n      })\n    }\n\n    function unsubscribe() {\n      $window.bluetoothSerial.unsubscribe(function () {\n        logService.consoleLog('Succesfully unsubscribed');\n        statusService.setSubscribed(false);\n      }, function () {\n        logService.consoleLog('ERROR: could not unsubscribe');\n      })\n    }\n\n    function write(str, cb) {\n      if (statusService.getEmergency() === false) {\n        const commandWithCRC = crcService.appendCRC(str);\n        $window.bluetoothSerial.write(commandWithCRC, function () {\n          logService.consoleLog('sent: '+commandWithCRC);\n          lastCommandTime = Date.now();\n          if (cb) cb();\n        }, function () {\n          logService.consoleLog('ERROR: could not send command '+str);\n        })\n      }\n    }\n\n    function writeBuffered() {\n      var commandIDObj = sendAndReceive.addToCommandObj(str);\n      if (statusService.getEmergency() === false) {\n        var command;\n        //Used for buffered commands. Command with brackets: \"<r34001>\", without brackets: \"r34001\n        var commandWithoutBrackets = str.slice(1, str.length-1);\n        command = '<c'+commandWithoutBrackets+'$'+commandIDObj.ID+'>';\n\n        $window.bluetoothSerial.write(command, function () {\n          logService.consoleLog('sent: '+command);\n          lastCommandTime = Date.now();\n        }, function () {\n          logService.consoleLog('ERROR: could not send command '+str+' , callingFunction: '+callingFunction);\n        });\n        sendAndReceive.checkInterpretedResponse(commandIDObj.ID);\n      }\n      else {\n        logService.addOne('Emergency pressed, will not send command')\n      }\n    }\n\n    function checkInterpretedResponse(commandID) {\n      var interpreted = false;\n      var checkInterpreted = $rootScope.$on('bluetoothResponse', function (event, res) {\n        if (res.search('10:<c') > -1 && res.search(commandID) > -1) {\n          interpreted = true;\n          checkInterpreted();\n        }\n      });\n      $timeout(function () {\n        if (!interpreted) {\n          logService.consoleLog('incorrect interpretation, ID: '+commandID);\n          $rootScope.$emit('faultyResponse');\n          checkInterpreted();\n        }\n      },2500)\n    }\n\n    function startPing() {\n      stepMotorNum = shareSettings.getObj().stepMotorNum;\n      ping = $interval(function () {\n        sendAndReceive.write('<w'+stepMotorNum+'>');\n      },500)\n    }\n\n    function stopPing() {\n      $interval.cancel(ping);\n    }\n\n    function getNewCommandID() {\n      commandIdStr = window.localStorage['commandIdNum'];\n      var commandIdNum = Number(commandIdStr);\n      commandIdNum += 1;\n      sendAndReceive.setCommandID(commandIdNum);\n      return commandIdNum;\n    }\n\n    function setCommandID(num) {\n      window.localStorage['commandIdNum'] = num;\n    }\n\n    function resetCommandObj() {\n      commandObj= {};\n    }\n\n    function expectedResponse(str) {\n      stepMotorNum = shareSettings.getObj().stepMotorNum;\n      switch (str) {\n        case '<':\n          return '8:y';\n          break;\n        case 'd':\n          return '12:';\n          break;\n        case 'b':\n          return '13:';\n          break;\n        case 'x':\n          return '14:';\n          break;\n        case 'v':\n          return '9:';\n          break;\n        case 's':\n          return '6:';\n          break;\n        case 'p':\n          return '5:';\n          break;\n        case 'r':\n          return '3:';\n          break;\n        case 'o':\n          return '2:';\n          break;\n        case 'f':\n          return '11:';\n          break;\n        case 'k':\n          return ['0:rdy', 'FAULT'];\n          break;\n        case 'q':\n          buttonService.setValues({'showSpinner':true});\n          return ['rdy','wydone','q'];\n          break;\n        case 'h':\n          return '6:';\n          break;\n        case 'z':\n          return '14:';\n          break;\n        case 'w':\n          return ['wydone','w'+stepMotorNum] ;\n          break;\n      }\n    }\n\n    function addToCommandObj(str) {\n      var id = sendAndReceive.getNewCommandID();\n      var expectedResponse = sendAndReceive.expectedResponse(str);\n      var obj = {\n        'ID': id,\n        'command': str, //ex: <q2456>\n        'expectedResponse': expectedResponse,\n        'interpreted': false,\n        'response': ''\n      };\n      commandObj[id] = obj;\n      return obj;\n    }\n\n    function emitResponse(res) {\n      logService.consoleLog('response in emitResponse: '+res);\n      var settings = shareSettings.getObj();\n      //handle stopswitch hit\n      if (res.search('wydone:') > -1 && res.search('wydone:0') === -1) {\n        var posStopswitch = res.lastIndexOf('@')-3;\n        $ionicPopup.alert({\n          title: 'Error: hit stopswitch '+res.charAt(posStopswitch),\n          template: 'Unexpected stopswitch has been hit. Aborting task and resetting program.'\n        });\n        logService.consoleLog('Error: hit stopswitch '+res.charAt(posStopswitch));\n        logService.addOne('Error: hit stopswitch '+res.charAt(posStopswitch));\n        //emergencyService.on sets correct buttons and sends resetcommand\n        emergencyService.on();\n        $rootScope.$emit('stopswitchHit', res, res.charAt(posStopswitch));\n      }\n\n      //handle encoder missed steps\n      //splice result from '@' till end\n      // in splicedStr, splice again from pos[2] ([0] = @, [1] is status code), till indexOf(';')\n      else if (res.search('wydone:') > -1 && res.search('@5') > -1 && settings.encoder.enable === true) {\n\n        var splicedStr = res.slice(res.lastIndexOf('@'));\n        var missedSteps = splicedStr.slice(2, splicedStr.indexOf(';'));\n        var maxAllowedMiss = settings.encoder.stepsToMiss ? settings.encoder.stepsToMiss : 'unknown';\n        $ionicPopup.alert({\n          title: 'You have missed the maximum number of allowed steps',\n          template: 'The program has been stopped.<p>Maximum steps to miss: '+maxAllowedMiss+'</p><p>Number of steps actually missed '+missedSteps+'</p>'\n        });\n        logService.consoleLog('ERROR: hit max number of allowed steps');\n        logService.addOne('ERROR: exceeded maximum number of steps to miss (encoder setting)');\n        emergencyService.on();\n        $rootScope.$emit('maxSteps', res, missedSteps)\n      }\n      else if (res.search('2:') > -1) {\n        $rootScope.$emit('sendKfault', res);\n      }\n      else if (res.indexOf('$') > -1 && res.search('10:') === -1) {\n        logService.consoleLog('\\nERROR:\\nPotential faulty response: '+res);\n        var numStr1 = res.slice(res.indexOf('$')+1, res.indexOf('>'));\n        var commandID1 = Number(numStr1);\n        var commandIDObj = commandObj[commandID1];\n        logService.consoleLog('commandIDObj.command: '+commandIDObj.command);\n        if (res.search(commandIDObj.command) === -1) {\n          logService.consoleLog('confirmed faulty response');\n          $rootScope.$emit('faultyResponse', res);\n          delete  commandObj[commandID1];\n        }\n      }\n      else if (res.search('&') > -1 && res.search('wydone')> -1) {\n        var numStr = res.slice(res.indexOf('>')+1, res.indexOf('&'));\n        var commandID = Number(numStr);\n\n        $rootScope.$emit('bufferedCommandDone', res, commandID);\n      }\n      else {\n        $rootScope.$emit('bluetoothResponse', res);\n      }\n    }\n\n    function sendEmergency() {\n      logService.consoleLog('sendAndReceiveService.sendEmergency called');\n      if (statusService.getSubscribed() === false) sendAndReceive.subscribe();\n      createResetListener( function () {\n        stepMotorNum = shareSettings.getObj().stepMotorNum;\n        $window.bluetoothSerial.write('<<y8:y'+stepMotorNum+'>', function () {\n          logService.addOne('Program reset command sent');\n        }, function (err) {\n          logService.addOne('Error: Program reset command could not be sent. '+err);\n        });\n      });\n    }\n\n    function createResetListener(cb) {\n      var emergencyResponse = $rootScope.$on('bluetoothResponse', function (event, res) {\n        if (res.search('<8:y>')) {\n          logService.addOne('Program succesfully reset');\n          emergencyResponse();\n        }\n      });\n      if (cb) cb();\n    }\n\n    function clearBuffer() {\n      $window.bluetoothSerial.clear(function () {\n        logService.consoleLog('Received buffer cleared');\n      }, function () {\n        logService.consoleLog('Error: could not clear receive buffer');\n      })\n    }\n  };\n\n\n\n\n\n// WEBPACK FOOTER //\n// ./C:/Users/Patrick/WebstormProjects/Toothmaster/es6/sendAndReceiveService.js"],"sourceRoot":""}